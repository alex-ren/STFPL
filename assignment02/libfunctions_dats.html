<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    .atsyntax {color:#E80000;background-color:#E0E0E0}
    .atsyntax span.comment {color:#787878;font-style:italic}
    .atsyntax span.extern  {color:#A52A2A}
    .atsyntax span.keyword {color:#000000;font-weight:bold}
    .atsyntax span.neuexp  {color:#800080}
    .atsyntax span.staexp  {color:#0000FF}
    .atsyntax span.dynexp  {color:#E80000}
    .atsyntax span.prfexp  {color:#009000}
    .atsyntax span.stacstdec  {text-decoration:none}
    .atsyntax span.stacstuse  {color:#0000CF;text-decoration:underline}
    .atsyntax span.dyncstdec  {text-decoration:none}
    .atsyntax span.dyncstimp  {color:#B80000;text-decoration:underline}
    .atsyntax span.dyncstuse  {color:#B80000;text-decoration:underline}
    body {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre class="atsyntax">

<span class="keyword">staload</span> <span class="staexp">"libfunctions.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"absyn.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"trans1.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"symbol.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"trans2.sats"</span>

<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anon*)</span> <span class="keyword">=</span> "prelude/DATS/reference.dats"</span>
<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anon*)</span> <span class="keyword">=</span> "symbol.dats"</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="210"><span class="stacstdec">sym <span class="keyword">=</span> symbol_t</span></a></span>

<span class="keyword">#define</span> <span class="neuexp">:: list0_cons</span>
<span class="keyword">#define</span> <span class="neuexp">cons list0_cons</span>
<span class="keyword">#define</span> <span class="neuexp">nil list0_nil</span>

<span class="keyword">#define</span> <span class="neuexp">Some0 option0_some</span>
<span class="keyword">#define</span> <span class="neuexp">None0 option0_none</span>

<span class="comment">(* ******** *********** *)</span>

<span class="keyword">val</span> string_LIST_CONS     <span class="keyword">=</span> "list_cons"
<span class="keyword">val</span> string_LIST_NIL      <span class="keyword">=</span> "list_nil"
<span class="keyword">val</span> string_LIST_IS_EMPTY <span class="keyword">=</span> "list_is_empty"
<span class="keyword">val</span> string_LIST_HEAD     <span class="keyword">=</span> "list_head"
<span class="keyword">val</span> string_LIST_TAIL     <span class="keyword">=</span> "list_tail"
<span class="keyword">val</span> string_STRING_ADD    <span class="keyword">=</span> "string_add"


<span class="keyword">implement</span> symbol_LIST_CONS     <span class="keyword">=</span> symbol_make_name string_LIST_CONS
<span class="keyword">implement</span> symbol_LIST_NIL      <span class="keyword">=</span> symbol_make_name string_LIST_NIL
<span class="keyword">implement</span> symbol_LIST_IS_EMPTY <span class="keyword">=</span> symbol_make_name string_LIST_IS_EMPTY
<span class="keyword">implement</span> symbol_LIST_HEAD     <span class="keyword">=</span> symbol_make_name string_LIST_HEAD
<span class="keyword">implement</span> symbol_LIST_TAIL     <span class="keyword">=</span> symbol_make_name string_LIST_TAIL
<span class="keyword">implement</span> symbol_STRING_ADD    <span class="keyword">=</span> symbol_make_name string_STRING_ADD


<span class="keyword">val</span> label_LIST_CONS     <span class="keyword">=</span> funlab_allocate symbol_LIST_CONS
<span class="keyword">val</span> label_LIST_NIL      <span class="keyword">=</span> funlab_allocate symbol_LIST_NIL
<span class="keyword">val</span> label_LIST_IS_EMPTY <span class="keyword">=</span> funlab_allocate symbol_LIST_IS_EMPTY
<span class="keyword">val</span> label_LIST_HEAD     <span class="keyword">=</span> funlab_allocate symbol_LIST_HEAD
<span class="keyword">val</span> label_LIST_TAIL     <span class="keyword">=</span> funlab_allocate symbol_LIST_TAIL
<span class="keyword">val</span> label_STRING_ADD    <span class="keyword">=</span> funlab_allocate symbol_STRING_ADD


<span class="keyword">val</span> tmpvar_LIST_CONS     <span class="keyword">=</span> tmpvar_new_string_name string_LIST_CONS
<span class="keyword">val</span> tmpvar_LIST_NIL      <span class="keyword">=</span> tmpvar_new_string_name string_LIST_NIL
<span class="keyword">val</span> tmpvar_LIST_IS_EMPTY <span class="keyword">=</span> tmpvar_new_string_name string_LIST_IS_EMPTY
<span class="keyword">val</span> tmpvar_LIST_HEAD     <span class="keyword">=</span> tmpvar_new_string_name string_LIST_HEAD
<span class="keyword">val</span> tmpvar_LIST_TAIL     <span class="keyword">=</span> tmpvar_new_string_name string_LIST_TAIL
<span class="keyword">val</span> tmpvar_STRING_ADD    <span class="keyword">=</span> tmpvar_new_string_name string_STRING_ADD


<span class="keyword">val</span> t2yp_list <span class="keyword">=</span> T2YPlist <span class="keyword">(</span>T2YPvar<span class="keyword">)</span>

<span class="keyword">val</span> t2yp_LIST_CONS     <span class="keyword">=</span> T2YPclo <span class="keyword">(</span>3<span class="keyword">,</span> T2YPenv :: T2YPvar :: t2yp_list :: nil<span class="keyword">,</span> t2yp_list<span class="keyword">)</span>
<span class="keyword">val</span> t2yp_LIST_NIL      <span class="keyword">=</span> T2YPclo <span class="keyword">(</span>1<span class="keyword">,</span> T2YPenv :: nil<span class="keyword">,</span> t2yp_list<span class="keyword">)</span>
<span class="keyword">val</span> t2yp_LIST_IS_EMPTY <span class="keyword">=</span> T2YPclo <span class="keyword">(</span>2<span class="keyword">,</span> T2YPenv :: t2yp_list :: nil<span class="keyword">,</span> T2YPbool<span class="keyword">)</span>
<span class="keyword">val</span> t2yp_LIST_HEAD     <span class="keyword">=</span> T2YPclo <span class="keyword">(</span>2<span class="keyword">,</span> T2YPenv :: t2yp_list :: nil<span class="keyword">,</span> T2YPvar<span class="keyword">)</span>
<span class="keyword">val</span> t2yp_LIST_TAIL     <span class="keyword">=</span> T2YPclo <span class="keyword">(</span>2<span class="keyword">,</span> T2YPenv :: t2yp_list :: nil<span class="keyword">,</span> t2yp_list<span class="keyword">)</span>
<span class="keyword">val</span> t2yp_STRING_ADD    <span class="keyword">=</span> T2YPclo <span class="keyword">(</span>3<span class="keyword">,</span> T2YPenv :: T2YPstr :: T2YPstr :: nil<span class="keyword">,</span> T2YPstr<span class="keyword">)</span>


<span class="keyword">val</span> vpnode_LIST_CONS     <span class="keyword">=</span> VPclo <span class="keyword">(</span>tmpvar_LIST_CONS<span class="keyword">,</span> label_LIST_CONS<span class="keyword">,</span> nil<span class="keyword">)</span>
<span class="keyword">val</span> vpnode_LIST_NIL      <span class="keyword">=</span> VPclo <span class="keyword">(</span>tmpvar_LIST_NIL<span class="keyword">,</span> label_LIST_NIL<span class="keyword">,</span> nil<span class="keyword">)</span>
<span class="keyword">val</span> vpnode_LIST_IS_EMPTY <span class="keyword">=</span> VPclo <span class="keyword">(</span>tmpvar_LIST_IS_EMPTY<span class="keyword">,</span> label_LIST_IS_EMPTY<span class="keyword">,</span> nil<span class="keyword">)</span>
<span class="keyword">val</span> vpnode_LIST_HEAD     <span class="keyword">=</span> VPclo <span class="keyword">(</span>tmpvar_LIST_HEAD<span class="keyword">,</span> label_LIST_HEAD<span class="keyword">,</span> nil<span class="keyword">)</span>
<span class="keyword">val</span> vpnode_LIST_TAIL     <span class="keyword">=</span> VPclo <span class="keyword">(</span>tmpvar_LIST_TAIL<span class="keyword">,</span> label_LIST_TAIL<span class="keyword">,</span> nil<span class="keyword">)</span>
<span class="keyword">val</span> vpnode_STRING_ADD    <span class="keyword">=</span> VPclo <span class="keyword">(</span>tmpvar_STRING_ADD<span class="keyword">,</span> label_STRING_ADD<span class="keyword">,</span> nil<span class="keyword">)</span>


<span class="keyword">val</span> valprim_LIST_CONS     <span class="keyword">=</span> make_valprim <span class="keyword">(</span>vpnode_LIST_CONS<span class="keyword">,</span>     t2yp_LIST_CONS<span class="keyword">)</span>
<span class="keyword">val</span> valprim_LIST_NIL      <span class="keyword">=</span> make_valprim <span class="keyword">(</span>vpnode_LIST_NIL<span class="keyword">,</span>      t2yp_LIST_NIL<span class="keyword">)</span>
<span class="keyword">val</span> valprim_LIST_IS_EMPTY <span class="keyword">=</span> make_valprim <span class="keyword">(</span>vpnode_LIST_IS_EMPTY<span class="keyword">,</span> t2yp_LIST_IS_EMPTY<span class="keyword">)</span>
<span class="keyword">val</span> valprim_LIST_HEAD     <span class="keyword">=</span> make_valprim <span class="keyword">(</span>vpnode_LIST_HEAD<span class="keyword">,</span>     t2yp_LIST_HEAD<span class="keyword">)</span>
<span class="keyword">val</span> valprim_LIST_TAIL     <span class="keyword">=</span> make_valprim <span class="keyword">(</span>vpnode_LIST_TAIL<span class="keyword">,</span>     t2yp_LIST_TAIL<span class="keyword">)</span>
<span class="keyword">val</span> valprim_STRING_ADD    <span class="keyword">=</span> make_valprim <span class="keyword">(</span>vpnode_STRING_ADD<span class="keyword">,</span>    t2yp_STRING_ADD<span class="keyword">)</span>

<span class="keyword">abstype</span> <span class="staexp"><a name="3243"><span class="stacstdec">theConstTypMap_t</span></a></span>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="3272"><span class="dyncstdec">ConstTypMapFind <span class="keyword">(</span>nam<span class="keyword">:</span> <span class="staexp">sym</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">option0 t1yp</span></span></a>

<span class="keyword">local</span>

<span class="keyword">assume</span> <span class="staexp">theConstTypMap_t <span class="keyword">=</span> symenv_t <span class="keyword">(</span>t1yp<span class="keyword">)</span></span>

<span class="keyword">macdef</span> <span class="neuexp">list0_sing <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> list0_cons <span class="keyword">(</span><span class="keyword">,(</span>x<span class="keyword">)</span><span class="keyword">,</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span></span>

<span class="keyword">val</span> theConstTypMap <span class="keyword">=</span>
  res <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">val</span> t1yp_int1 <span class="keyword">=</span> T1YPtup <span class="keyword">(</span>t1yp_int :: nil<span class="keyword">)</span>
  <span class="keyword">val</span> t1yp_int2 <span class="keyword">=</span> T1YPtup <span class="keyword">(</span>t1yp_int :: t1yp_int :: nil<span class="keyword">)</span>
  <span class="keyword">val</span> t1yp_str1 <span class="keyword">=</span> T1YPtup <span class="keyword">(</span>t1yp_string :: nil<span class="keyword">)</span>
  <span class="keyword">val</span> t1yp_str2 <span class="keyword">=</span> T1YPtup <span class="keyword">(</span>t1yp_string :: t1yp_string :: nil<span class="keyword">)</span>
  <span class="keyword">val</span> t1yp_aop <span class="keyword">=</span> T1YPfun <span class="keyword">(</span>ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>2<span class="keyword">)</span><span class="keyword">,</span> t1yp_int2<span class="keyword">,</span> t1yp_int<span class="keyword">)</span>
  <span class="keyword">val</span> t1yp_bop <span class="keyword">=</span> T1YPfun <span class="keyword">(</span>ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>2<span class="keyword">)</span><span class="keyword">,</span> t1yp_int2<span class="keyword">,</span> t1yp_bool<span class="keyword">)</span>
  <span class="keyword">typedef</span> <span class="staexp"><a name="3816"><span class="stacstdec">T <span class="keyword">=</span> <span class="keyword">@(</span>sym<span class="keyword">,</span> t1yp<span class="keyword">)</span></span></a></span>
  <span class="keyword">val</span> cts <span class="keyword">=</span> <span class="keyword">(</span>
    <span class="keyword">(</span>symbol_PLUS<span class="keyword">,</span> t1yp_aop<span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_MINUS<span class="keyword">,</span> t1yp_aop<span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_TIMES<span class="keyword">,</span> t1yp_aop<span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_SLASH<span class="keyword">,</span> t1yp_aop<span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_UMINUS<span class="keyword">,</span> T1YPfun <span class="keyword">(</span>ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>1<span class="keyword">)</span><span class="keyword">,</span> t1yp_int1<span class="keyword">,</span> t1yp_int<span class="keyword">)</span><span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_GT<span class="keyword">,</span> t1yp_bop<span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_GTE<span class="keyword">,</span> t1yp_bop<span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_LT<span class="keyword">,</span> t1yp_bop<span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_LTE<span class="keyword">,</span> t1yp_bop<span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_EQ<span class="keyword">,</span> t1yp_bop<span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_NEQ<span class="keyword">,</span> t1yp_bop<span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_PRINT_INT<span class="keyword">,</span> T1YPfun <span class="keyword">(</span>ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>1<span class="keyword">)</span><span class="keyword">,</span> t1yp_int1<span class="keyword">,</span> t1yp_unit<span class="keyword">)</span><span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_PRINT<span class="keyword">,</span> T1YPfun <span class="keyword">(</span>ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>1<span class="keyword">)</span><span class="keyword">,</span> t1yp_str1<span class="keyword">,</span> t1yp_unit<span class="keyword">)</span><span class="keyword">)</span> ::
    <span class="keyword">(</span>symbol_STRING_ADD<span class="keyword">,</span> T1YPfun <span class="keyword">(</span>ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>2<span class="keyword">)</span><span class="keyword">,</span> t1yp_str2<span class="keyword">,</span> t1yp_str1<span class="keyword">)</span><span class="keyword">)</span> ::
    nil <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">list0 <span class="keyword">(</span>T<span class="keyword">)</span></span> <span class="comment">// end of [val]
</span>  <span class="keyword">val</span> res<span class="keyword">:</span> <span class="staexp">theConstTypMap_t</span> <span class="keyword">=</span> symenv_make <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">fun</span> loop <span class="keyword">(</span>
    cts<span class="keyword">:</span> <span class="staexp">list0 <span class="keyword">(</span>T<span class="keyword">)</span></span><span class="keyword">,</span> res<span class="keyword">:</span> <span class="staexp">theConstTypMap_t</span>
  <span class="keyword">)</span> <span class="keyword">:</span> <span class="staexp">theConstTypMap_t</span> <span class="keyword">=</span>
    <span class="keyword">case+</span> cts <span class="keyword">of</span>
    <span class="keyword">|</span> ct :: cts <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val</span> res<span class="comment">(*_already*)</span> <span class="keyword">=</span> symenv_insert <span class="keyword">(</span>res<span class="keyword">,</span> ct<span class="keyword">.</span>0<span class="keyword">,</span> ct<span class="keyword">.</span>1<span class="keyword">)</span> <span class="keyword">in</span> loop <span class="keyword">(</span>cts<span class="keyword">,</span> res<span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [::]
</span>    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> res
  <span class="comment">// end of [loop]  
</span>  <span class="keyword">val</span> res <span class="keyword">=</span> loop <span class="keyword">(</span>cts<span class="keyword">,</span> res<span class="keyword">)</span>
<span class="keyword">}</span> <span class="comment">// end of [val]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">fun</span> ConstTypMapFind <span class="keyword">(</span>nam<span class="keyword">:</span> <span class="staexp">sym</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">option0 t1yp</span> <span class="keyword">=</span>
  symenv_lookup&lt;<span class="staexp">t1yp</span><span class="keyword">&gt;</span> <span class="keyword">(</span>theConstTypMap<span class="keyword">,</span> nam<span class="keyword">)</span>
<span class="comment">// end of [theConstTypFind]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="keyword">implement</span>
libOprTypFind <span class="keyword">(</span>opr<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val+</span> OPR sym <span class="keyword">=</span> opr
<span class="keyword">in</span>
  ConstTypMapFind <span class="keyword">(</span>sym<span class="keyword">)</span>
<span class="keyword">end</span>  <span class="comment">// end of [libOprTypFind]
</span>
<span class="keyword">fun</span> constructorTypFind <span class="keyword">(</span>fname<span class="keyword">:</span> <span class="staexp">sym</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">option0 t1yp</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> 0 <span class="keyword">of</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> fname <span class="keyword">=</span> symbol_LIST_CONS <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="comment">// list_cons (x: X, xs: list X): list X
</span>    <span class="keyword">val</span> t1var <span class="keyword">=</span> t1Var_new <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> t1Var_set_typ <span class="keyword">(</span>t1var<span class="keyword">,</span> T1YPvar <span class="keyword">(</span>t1Var_new <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">val</span> X <span class="keyword">=</span> T1YPvar <span class="keyword">(</span>t1var<span class="keyword">)</span>
    <span class="keyword">val</span> listX <span class="keyword">=</span> T1YPlist <span class="keyword">(</span>t1var<span class="keyword">)</span>
    <span class="keyword">val</span> args <span class="keyword">=</span> X :: listX :: nil
  <span class="keyword">in</span>
    Some0 <span class="keyword">(</span>T1YPfun <span class="keyword">(</span>ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>2<span class="keyword">)</span><span class="keyword">,</span> T1YPtup <span class="keyword">(</span>args<span class="keyword">)</span><span class="keyword">,</span> listX<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> fname <span class="keyword">=</span> symbol_LIST_NIL <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="comment">// list_nil (): list X
</span>    <span class="keyword">val</span> t1var <span class="keyword">=</span> t1Var_new <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> t1Var_set_typ <span class="keyword">(</span>t1var<span class="keyword">,</span> T1YPvar <span class="keyword">(</span>t1Var_new <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">val</span> listX <span class="keyword">=</span> T1YPlist <span class="keyword">(</span>t1var<span class="keyword">)</span>
  <span class="keyword">in</span>
    Some0 <span class="keyword">(</span>T1YPfun <span class="keyword">(</span>ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>0<span class="keyword">)</span><span class="keyword">,</span> t1yp_unit<span class="keyword">,</span> listX<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> fname <span class="keyword">=</span> symbol_LIST_IS_EMPTY <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="comment">// list_is_empty (xs: list X): bool
</span>    <span class="keyword">val</span> t1var <span class="keyword">=</span> t1Var_new <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> t1Var_set_typ <span class="keyword">(</span>t1var<span class="keyword">,</span> T1YPvar <span class="keyword">(</span>t1Var_new <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">val</span> listX <span class="keyword">=</span> T1YPlist <span class="keyword">(</span>t1var<span class="keyword">)</span>
  <span class="keyword">in</span>
    Some0 <span class="keyword">(</span>T1YPfun <span class="keyword">(</span>ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>1<span class="keyword">)</span><span class="keyword">,</span> listX<span class="keyword">,</span> t1yp_bool<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> fname <span class="keyword">=</span> symbol_LIST_HEAD <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="comment">// list_head (xs: list X): X
</span>    <span class="keyword">val</span> t1var <span class="keyword">=</span> t1Var_new <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> t1Var_set_typ <span class="keyword">(</span>t1var<span class="keyword">,</span> T1YPvar <span class="keyword">(</span>t1Var_new <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">val</span> X <span class="keyword">=</span> T1YPvar <span class="keyword">(</span>t1var<span class="keyword">)</span>
    <span class="keyword">val</span> listX <span class="keyword">=</span> T1YPlist <span class="keyword">(</span>t1var<span class="keyword">)</span>
  <span class="keyword">in</span>
    Some0 <span class="keyword">(</span>T1YPfun <span class="keyword">(</span>ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>1<span class="keyword">)</span><span class="keyword">,</span> listX<span class="keyword">,</span> X<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> fname <span class="keyword">=</span> symbol_LIST_TAIL <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="comment">// list_tail (xs: list X): list X
</span>    <span class="keyword">val</span> t1var <span class="keyword">=</span> t1Var_new <span class="keyword">(</span><span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> t1Var_set_typ <span class="keyword">(</span>t1var<span class="keyword">,</span> T1YPvar <span class="keyword">(</span>t1Var_new <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">val</span> listX <span class="keyword">=</span> T1YPlist <span class="keyword">(</span>t1var<span class="keyword">)</span>
  <span class="keyword">in</span>
    Some0 <span class="keyword">(</span>T1YPfun <span class="keyword">(</span>ref_make_elt&lt;<span class="staexp">int</span><span class="keyword">&gt;</span> <span class="keyword">(</span>1<span class="keyword">)</span><span class="keyword">,</span> listX<span class="keyword">,</span> listX<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">end</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> None0 <span class="keyword">(</span><span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* fun libSymTypFind (nam: $Symbol.symbol_t): option0 $Trans1.t1yp *)</span>
<span class="keyword">implement</span> libSymTypFind <span class="keyword">(</span>nam<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> t1yp_opt <span class="keyword">=</span> ConstTypMapFind <span class="keyword">(</span>nam<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> t1yp_opt <span class="keyword">of</span>
  <span class="keyword">|</span> Some0 _ <span class="keyword">=&gt;</span> t1yp_opt
  <span class="keyword">|</span> None0 <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> constructorTypFind <span class="keyword">(</span>nam<span class="keyword">)</span>
<span class="keyword">end</span>

<span class="keyword">implement</span> libFunVPFind <span class="keyword">(</span>fname<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> 0 <span class="keyword">of</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> fname <span class="keyword">=</span> symbol_LIST_CONS <span class="keyword">=&gt;</span> 
      Some0 <span class="keyword">(</span>valprim_LIST_CONS<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> fname <span class="keyword">=</span> symbol_LIST_NIL <span class="keyword">=&gt;</span> 
      Some0 <span class="keyword">(</span>valprim_LIST_NIL<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> fname <span class="keyword">=</span> symbol_LIST_IS_EMPTY <span class="keyword">=&gt;</span>
      Some0 <span class="keyword">(</span>valprim_LIST_IS_EMPTY<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> fname <span class="keyword">=</span> symbol_LIST_HEAD <span class="keyword">=&gt;</span>
      Some0 <span class="keyword">(</span>valprim_LIST_HEAD<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> fname <span class="keyword">=</span> symbol_LIST_TAIL <span class="keyword">=&gt;</span>
      Some0 <span class="keyword">(</span>valprim_LIST_TAIL<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">when</span> fname <span class="keyword">=</span> symbol_STRING_ADD <span class="keyword">=&gt;</span>
      Some0 <span class="keyword">(</span>valprim_STRING_ADD<span class="keyword">)</span>
  <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> None0 <span class="keyword">(</span><span class="keyword">)</span>







</pre>
</body>
</html>
