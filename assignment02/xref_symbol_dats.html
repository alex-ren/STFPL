<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    .atsyntax {color:#E80000;background-color:#E0E0E0}
    .atsyntax span.comment {color:#787878;font-style:italic}
    .atsyntax span.extern  {color:#A52A2A}
    .atsyntax span.keyword {color:#000000;font-weight:bold}
    .atsyntax span.neuexp  {color:#800080}
    .atsyntax span.staexp  {color:#0000FF}
    .atsyntax span.dynexp  {color:#E80000}
    .atsyntax span.prfexp  {color:#009000}
    .atsyntax span.stacstdec  {text-decoration:none}
    .atsyntax span.stacstuse  {color:#0000CF;text-decoration:underline}
    .atsyntax span.dyncstdec  {text-decoration:none}
    .atsyntax span.dyncstimp  {color:#B80000;text-decoration:underline}
    .atsyntax span.dyncstuse  {color:#B80000;text-decoration:underline}
    body {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre class="atsyntax">
<span class="comment">(*
** CAS CS525, Spring 2011
** Instructor: Hongwei Xi
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="comment">// Put your name here
</span><span class="comment">//
</span><span class="comment">(* ****** ****** *)</span>

<span class="keyword">#include</span> <span class="neuexp">"CS525.hats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"symbol.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">assume</span> <span class="staexp">symbol_t <span class="keyword">=</span> <span class="keyword">'{</span>
  symbol_name<span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a><span class="keyword">,</span> symbol_index<span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15585"><span class="stacstuse">int</span></a>
<span class="keyword">}</span></span> <span class="comment">// end of [symbol_t]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#290"><span class="dyncstimp">fprint_symbol</span></a>
  <span class="keyword">(</span>out<span class="keyword">,</span> s<span class="keyword">)</span> <span class="keyword">=</span> fprint_string <span class="keyword">(</span>out<span class="keyword">,</span> s<span class="keyword">.</span>symbol_name<span class="keyword">)</span>
<span class="comment">// end of [fprint_symbol]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#378"><span class="dyncstimp">print_symbol</span></a> <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#290"><span class="dyncstuse">fprint_symbol</span></a> <span class="keyword">(</span>stdout_ref<span class="keyword">,</span> s<span class="keyword">)</span>
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#449"><span class="dyncstimp">prerr_symbol</span></a> <span class="keyword">(</span>s<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#290"><span class="dyncstuse">fprint_symbol</span></a> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> s<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#541"><span class="dyncstimp">eq_symbol_symbol</span></a>
  <span class="keyword">(</span>s1<span class="keyword">,</span> s2<span class="keyword">)</span> <span class="keyword">=</span> s1<span class="keyword">.</span>symbol_index <span class="keyword">=</span> s2<span class="keyword">.</span>symbol_index
<span class="comment">// end of [eq_symbol_symbol]
</span>
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#728"><span class="dyncstimp">compare_symbol_symbol</span></a>
  <span class="keyword">(</span>s1<span class="keyword">,</span> s2<span class="keyword">)</span> <span class="keyword">=</span> s1<span class="keyword">.</span>symbol_index <span class="keyword">\</span>compare s2<span class="keyword">.</span>symbol_index
<span class="comment">// end of [compare_symbol_symbol]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="819"><span class="dyncstdec">string_get_symbol <span class="keyword">(</span>name<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#88"><span class="stacstuse">symbol_t</span></a></span></span></a>

<span class="comment">//
</span><span class="comment">// HX: this is a naive implementation, which is to be replaced later
</span><span class="comment">//
</span><span class="keyword">local</span>

<span class="keyword">typedef</span> <span class="staexp"><a name="953"><span class="stacstdec">sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#88"><span class="stacstuse">symbol_t</span></a></span></a></span>
<span class="keyword">val</span> theCount <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2freference_2esats.html#2042"><span class="dyncstuse">ref&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15585"><span class="stacstuse">int</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>0<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
typedef symlst = list0 (sym)
*)</span>

<span class="comment">(*
val theTable = ref&lt;symlst&gt; (list0_nil)
*)</span>

<span class="comment">(* ****** ****** *)</span>
<span class="comment">//
</span><span class="keyword">staload</span> <span class="staexp">H <span class="keyword">=</span> "libats/SATS/hashtable_chain.sats"</span>
<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*H*)</span> <span class="keyword">=</span> "libats/DATS/hashtable_chain.dats"</span>
<span class="comment">//
</span><span class="keyword">abstype</span> <span class="staexp"><a name="1233"><span class="stacstdec">HASHTBLref</span></a></span> <span class="keyword">(</span>key<span class="keyword">:</span> t@ype<span class="keyword">,</span> itm<span class="keyword">:</span> viewt@ype<span class="keyword">)</span>
<span class="comment">//
</span><span class="keyword">extern</span>
<span class="keyword">castfn</span> <a name="1290"><span class="dyncstdec">HASHTBLref_encode
  <span class="staexp"><span class="keyword">{</span>key<span class="keyword">:</span>t@ype<span class="keyword">;</span>itm<span class="keyword">:</span>viewt@ype<span class="keyword">}</span></span>
  <span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>agz<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2flibats_2fSATS_2fhashtable_5fchain_2esats.html#2033"><span class="stacstuse">$H<span class="keyword">.</span>HASHTBLptr</span></a> <span class="keyword">(</span>key<span class="keyword">,</span> itm<span class="keyword">,</span> l<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#1233"><span class="stacstuse">HASHTBLref</span></a> <span class="keyword">(</span>key<span class="keyword">,</span> itm<span class="keyword">)</span></span></span></a>
<span class="comment">// end of [HASHTBLref_encode]
</span>
<span class="keyword">extern</span>
<span class="keyword">castfn</span> <a name="1447"><span class="dyncstdec">HASHTBLref_decode
  <span class="staexp"><span class="keyword">{</span>key<span class="keyword">:</span>t@ype<span class="keyword">;</span>itm<span class="keyword">:</span>viewt@ype<span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#1233"><span class="stacstuse">HASHTBLref</span></a> <span class="keyword">(</span>key<span class="keyword">,</span> itm<span class="keyword">)</span></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="keyword">!</span><span class="staexp">ref</span><span class="keyword">&gt;</span> <span class="staexp"><span class="keyword">[</span>l<span class="keyword">:</span>agz<span class="keyword">]</span> <span class="keyword">(</span>
  <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2flibats_2fSATS_2fhashtable_5fchain_2esats.html#2033"><span class="stacstuse">$H<span class="keyword">.</span>HASHTBLptr</span></a> <span class="keyword">(</span>key<span class="keyword">,</span> itm<span class="keyword">,</span> l<span class="keyword">)</span> <span class="keyword">-&lt;</span>lin<span class="keyword">,</span>prf<span class="keyword">&gt;</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16468"><span class="stacstuse">void</span></a> <span class="keyword">|</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2flibats_2fSATS_2fhashtable_5fchain_2esats.html#2033"><span class="stacstuse">$H<span class="keyword">.</span>HASHTBLptr</span></a> <span class="keyword">(</span>key<span class="keyword">,</span> itm<span class="keyword">,</span> l<span class="keyword">)</span>
<span class="keyword">)</span></span></span></a> <span class="comment">// end of [HASHTBLref_decode]
</span>
<span class="keyword">val</span> theTable
  <span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#1233"><span class="stacstuse">HASHTBLref</span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a><span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#953"><span class="stacstuse">sym</span></a><span class="keyword">)</span></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> hash <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2finteger_2esats.html#20641"><span class="stacstuse">ulint</span></a></span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2fstring_2esats.html#18552"><span class="dyncstuse">string_hash_33</span></a> <span class="keyword">(</span>x<span class="keyword">)</span>
  <span class="keyword">val</span> eqfn <span class="keyword">=</span> <span class="keyword">lam</span> <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15152"><span class="stacstuse">bool</span></a></span> <span class="keyword">=&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="keyword">(</span>x1 <span class="keyword">=</span> x2<span class="keyword">)</span>
  <span class="keyword">val</span> x <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2flibats_2fSATS_2fhashtable_5fchain_2esats.html#5171"><span class="dyncstuse">$H<span class="keyword">.</span>hashtbl_make</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a><span class="keyword">,</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#953"><span class="stacstuse">sym</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>hash<span class="keyword">,</span> eqfn<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#1290"><span class="dyncstuse">HASHTBLref_encode</span></a> <span class="keyword">(</span>x<span class="keyword">)</span>
<span class="keyword">end</span> <span class="comment">// end of [val]
</span>
<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="comment">(*
implement
string_get_symbol (name) = let
  val ans = list0_find_cloref&lt;sym&gt; (!theTable, lam (x) =&gt; x.symbol_name = name)
in
  case+ ans of
  | option0_some (x) =&gt; x
  | option0_none () =&gt; let
      val i = !theCount
      val () = !theCount := i+1
      val sym = '{
        symbol_name= name, symbol_index= i
      } // end of [val]
      val () = !theTable := list0_cons (sym, !theTable)
    in
      sym
    end // end of [option0_none]
end // end of [string_get_symbol]
*)</span>

<span class="keyword">implement</span>
<a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#819"><span class="dyncstimp">string_get_symbol</span></a> <span class="keyword">(</span>name<span class="keyword">)</span> <span class="keyword">=</span> <span class="comment">// '{symbol_name = "dd", symbol_index = 3}
</span><span class="keyword">let</span>
  <span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#953"><span class="stacstuse">sym</span></a>?</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">fpf_x</span> <span class="keyword">|</span> x<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#1447"><span class="dyncstuse">HASHTBLref_decode</span></a> <span class="keyword">(</span>theTable<span class="keyword">)</span>
  <span class="keyword">val</span> ans <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2flibats_2fSATS_2fhashtable_5fchain_2esats.html#4249"><span class="dyncstuse">$H<span class="keyword">.</span>hashtbl_search</span></a> <span class="keyword">(</span>x<span class="keyword">,</span> name<span class="keyword">,</span> res<span class="keyword">)</span>
  <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf_x <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">in</span>
  <span class="keyword">if</span> ans <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#8966"><span class="dyncstuse">opt_unsome</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#88"><span class="stacstuse">symbol_t</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>res<span class="keyword">)</span></span> <span class="keyword">in</span> res
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#9105"><span class="dyncstuse">opt_unnone</span></a> <span class="staexp"><span class="keyword">{</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#88"><span class="stacstuse">symbol_t</span></a><span class="keyword">}</span></span> <span class="keyword">(</span>res<span class="keyword">)</span></span>
    <span class="keyword">val</span> n <span class="keyword">=</span> <span class="keyword">!</span>theCount<span class="keyword">;</span> <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">!</span>theCount := n+1
    <span class="keyword">val</span> sym <span class="keyword">=</span> <span class="keyword">'{</span>
      symbol_name<span class="keyword">=</span> name<span class="keyword">,</span> symbol_index<span class="keyword">=</span> n
    <span class="keyword">}</span> <span class="comment">// end of [val]
</span>    <span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">fpf_x</span> <span class="keyword">|</span> x<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#1447"><span class="dyncstuse">HASHTBLref_decode</span></a> <span class="keyword">(</span>theTable<span class="keyword">)</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2flibats_2fSATS_2fhashtable_5fchain_2esats.html#4446"><span class="dyncstuse">$H<span class="keyword">.</span>hashtbl_insert&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">,</span><span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#88"><span class="stacstuse">symbol_t</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>x<span class="keyword">,</span> name<span class="keyword">,</span> sym<span class="keyword">)</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> fpf_x <span class="keyword">(</span>x<span class="keyword">)</span></span>  
  <span class="keyword">in</span>
    sym
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="keyword">end</span> <span class="comment">// end of [string_get_symbol]
</span>
<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(*
**
** please implement various operations on a symbol table
**
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#180"><span class="dyncstimp">symbol_get_name</span></a> <span class="keyword">(</span>x<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="comment">// val () = printf ("symbol_get_name\n", @())
</span>  <span class="keyword">val</span> ret <span class="keyword">=</span> x<span class="keyword">.</span>symbol_name
  <span class="comment">// val () = printf ("symbol_get_name10\n", @())
</span><span class="keyword">in</span>
  ret
<span class="keyword">end</span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstimp">symbol_make_name</span></a> <span class="keyword">(</span>name<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#819"><span class="dyncstuse">string_get_symbol</span></a> <span class="keyword">(</span>name<span class="keyword">)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#856"><span class="dyncstimp">symbol_BOOL</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "bool"
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#909"><span class="dyncstimp">symbol_INT</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "int"
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#959"><span class="dyncstimp">symbol_STRING</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "string"
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1018"><span class="dyncstimp">symbol_UNIT</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "unit"
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1071"><span class="dyncstimp">symbol_LIST</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "list"

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1146"><span class="dyncstimp">symbol_UMINUS</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "~"

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1183"><span class="dyncstimp">symbol_PLUS</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "+"
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1217"><span class="dyncstimp">symbol_MINUS</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "-"
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1252"><span class="dyncstimp">symbol_TIMES</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "*"
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1287"><span class="dyncstimp">symbol_SLASH</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "/"

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1323"><span class="dyncstimp">symbol_GT</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "&gt;"
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1355"><span class="dyncstimp">symbol_GTE</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "&gt;="
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1389"><span class="dyncstimp">symbol_LT</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "&lt;"
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1421"><span class="dyncstimp">symbol_LTE</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "&lt;="
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1455"><span class="dyncstimp">symbol_EQ</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "="
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1487"><span class="dyncstimp">symbol_NEQ</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "&lt;&gt;"

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1522"><span class="dyncstimp">symbol_PRINT</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "print"
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1561"><span class="dyncstimp">symbol_PRINT_INT</span></a> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#222"><span class="dyncstuse">symbol_make_name</span></a> "print_int"

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">local</span>

<span class="keyword">staload</span> <span class="staexp">M <span class="keyword">=</span> "libats/SATS/funmap_avltree.sats"</span>
<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*M*)</span> <span class="keyword">=</span> "libats/DATS/funmap_avltree.dats"</span>
<span class="keyword">assume</span> <span class="staexp">symenv_t <span class="keyword">(</span>a<span class="keyword">:</span>t@ype<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2flibats_2fSATS_2ffunmap_5favltree_2esats.html#1856"><span class="stacstuse">$M<span class="keyword">.</span>map</span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#88"><span class="stacstuse">symbol_t</span></a><span class="keyword">,</span> a<span class="keyword">)</span></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="4537"><span class="stacstdec">key <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#88"><span class="stacstuse">symbol_t</span></a></span></a></span>
<span class="keyword">fn</span><span class="keyword">{</span><span class="keyword">}</span> cmp <span class="keyword">(</span>k1<span class="keyword">:</span><span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#4537"><span class="stacstuse">key</span></a></span><span class="keyword">,</span> k2<span class="keyword">:</span><span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#4537"><span class="stacstuse">key</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#17351"><span class="stacstuse">Sgn</span></a></span> <span class="keyword">=</span> compare <span class="keyword">(</span>k1<span class="keyword">,</span> k2<span class="keyword">)</span>

<span class="keyword">in</span> <span class="comment">// in of [local]
</span>
<span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
<a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1668"><span class="dyncstimp">symenv_make</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2flibats_2fSATS_2ffunmap_5favltree_2esats.html#2114"><span class="dyncstuse">$M<span class="keyword">.</span>funmap_make_nil</span></a> <span class="keyword">(</span><span class="keyword">)</span>

<span class="comment">(*
fun{key,itm:t@ype}
funmap_search (
  m: map (key, itm), k0: key, cmp: cmp key, res: &amp;itm? &gt;&gt; opt (itm, b)
) :&lt;&gt; #[b:bool] bool b
// end of [funmap_search]
*)</span>
<span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
<a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1711"><span class="dyncstimp">symenv_lookup</span></a> <span class="keyword">(</span>env<span class="keyword">,</span> k0<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> res<span class="keyword">:</span> <span class="staexp">a?</span>
  <span class="keyword">val</span> ans <span class="keyword">=</span>
    <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2flibats_2fSATS_2ffunmap_5favltree_2esats.html#2607"><span class="dyncstuse">$M<span class="keyword">.</span>funmap_search&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#4537"><span class="stacstuse">key</span></a></span><span class="keyword">,</span><span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>env<span class="keyword">,</span> k0<span class="keyword">,</span> cmp<span class="keyword">,</span> res<span class="keyword">)</span>
  <span class="comment">// end of [val]
</span><span class="keyword">in</span>
  <span class="keyword">if</span> ans <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#8966"><span class="dyncstuse">opt_unsome</span></a> <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span> <span class="keyword">(</span>res<span class="keyword">)</span></span> <span class="keyword">in</span> option0_some <span class="keyword">(</span>res<span class="keyword">)</span>
  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="keyword">prval</span> <span class="prfexp"><span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#9105"><span class="dyncstuse">opt_unnone</span></a> <span class="staexp"><span class="keyword">{</span>a<span class="keyword">}</span></span> <span class="keyword">(</span>res<span class="keyword">)</span></span> <span class="keyword">in</span> option0_none <span class="keyword">(</span><span class="keyword">)</span>
  <span class="keyword">end</span> <span class="comment">// end of [if]
</span><span class="keyword">end</span> <span class="comment">// end of [symenv_lookup]
</span>
<span class="comment">(*
fun{key,itm:t@ype} funmap_insert (
  m: &amp;map (key, itm), k0: key, x0: itm, cmp: cmp key
) :&lt;&gt; bool(*[k0] alreay exists in [m]*) // end of [funmap_insert]
*)</span>
<span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
<a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1783"><span class="dyncstimp">symenv_insert</span></a> <span class="keyword">(</span>env<span class="keyword">,</span> k<span class="keyword">,</span> i<span class="keyword">)</span> <span class="keyword">=</span> env <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">var</span> env <span class="keyword">=</span> env
  <span class="keyword">val</span> ans<span class="comment">(*discarded*)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2flibats_2fSATS_2ffunmap_5favltree_2esats.html#2891"><span class="dyncstuse">$M<span class="keyword">.</span>funmap_insert&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2edats.html#4537"><span class="stacstuse">key</span></a></span><span class="keyword">,</span><span class="staexp">a</span><span class="keyword">&gt;</span> <span class="keyword">(</span>env<span class="keyword">,</span> k<span class="keyword">,</span> i<span class="keyword">,</span> cmp<span class="keyword">)</span>
<span class="keyword">}</span> <span class="comment">// end of [symenv_insert]
</span>
<span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
<a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1862"><span class="dyncstimp">symenv_inserts</span></a> <span class="keyword">(</span>env<span class="keyword">,</span> ps<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2flist0_2esats.html#3829"><span class="dyncstuse">list0_fold_left&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1634"><span class="stacstuse">symenv_t</span></a> a</span><span class="keyword">&gt;&lt;</span> <span class="staexp"><span class="keyword">@(</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#88"><span class="stacstuse">symbol_t</span></a><span class="keyword">,</span> a<span class="keyword">)</span></span><span class="keyword">&gt;</span> <span class="keyword">(</span>
  <span class="keyword">lam</span> <span class="keyword">(</span>init<span class="keyword">,</span> x<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1634"><span class="stacstuse">symenv_t</span></a> a</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1783"><span class="dyncstuse">symenv_insert</span></a> <span class="keyword">(</span>init<span class="keyword">,</span> x<span class="keyword">.</span>0<span class="keyword">,</span> x<span class="keyword">.</span>1<span class="keyword">)</span><span class="keyword">,</span> env<span class="keyword">,</span> ps<span class="keyword">)</span>

<span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
<a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#2134"><span class="dyncstimp">symenv_listize</span></a> <span class="keyword">(</span>env<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> xs_v <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2flibats_2fSATS_2ffunmap_5favltree_2esats.html#4217"><span class="dyncstuse">$M<span class="keyword">.</span>funmap_listize</span></a> <span class="keyword">(</span>env<span class="keyword">)</span>
  <span class="keyword">val</span> xs <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2flist0_2esats.html#2343"><span class="dyncstuse">list0_of_list_vt</span></a> <span class="keyword">(</span>xs_v<span class="keyword">)</span>
<span class="keyword">in</span>
  xs
<span class="keyword">end</span>

<span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
  <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1966"><span class="dyncstimp">symenv_merge</span></a> <span class="keyword">(</span>env1<span class="keyword">,</span> env2<span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1862"><span class="dyncstuse">symenv_inserts</span></a> <span class="keyword">(</span>env1<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#2134"><span class="dyncstuse">symenv_listize</span></a> <span class="keyword">(</span>env2<span class="keyword">)</span><span class="keyword">)</span>

<span class="keyword">implement</span><span class="keyword">{</span><span class="staexp">a</span><span class="keyword">}</span>
  <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#2060"><span class="dyncstimp">symenv_sub</span></a> <span class="keyword">(</span>env1<span class="keyword">,</span> env2<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> xs <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#2134"><span class="dyncstuse">symenv_listize</span></a> <span class="keyword">(</span>env1<span class="keyword">)</span>

  <span class="keyword">fun</span> loop <span class="keyword">(</span>xs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <span class="keyword">@(</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#88"><span class="stacstuse">symbol_t</span></a><span class="keyword">,</span> a<span class="keyword">)</span></span><span class="keyword">,</span> env<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1634"><span class="stacstuse">symenv_t</span></a> a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <span class="keyword">@(</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#88"><span class="stacstuse">symbol_t</span></a><span class="keyword">,</span> a<span class="keyword">)</span></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> xs <span class="keyword">of</span>
    <span class="keyword">|</span> list0_cons <span class="keyword">(</span>x<span class="keyword">,</span> xs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> vopt <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1711"><span class="dyncstuse">symenv_lookup</span></a> <span class="keyword">(</span>env<span class="keyword">,</span> x<span class="keyword">.</span>0<span class="keyword">)</span>
    <span class="keyword">in</span>
      <span class="keyword">case+</span> vopt <span class="keyword">of</span>
      <span class="keyword">|</span> option0_some _ <span class="keyword">=&gt;</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> env<span class="keyword">)</span>
      <span class="keyword">|</span> option0_none <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_cons <span class="keyword">(</span>x<span class="keyword">,</span> loop <span class="keyword">(</span>xs1<span class="keyword">,</span> env<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span>
    <span class="keyword">|</span> list0_nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> list0_nil

  <span class="keyword">val</span> xs1 <span class="keyword">=</span> loop <span class="keyword">(</span>xs<span class="keyword">,</span> env2<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1862"><span class="dyncstuse">symenv_inserts</span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1668"><span class="dyncstuse">symenv_make</span></a> <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">,</span> xs1<span class="keyword">)</span>
<span class="keyword">end</span>

<span class="keyword">end</span> <span class="comment">// end of [local]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [symbol.dats] *)</span>

</pre>
</body>
</html>
