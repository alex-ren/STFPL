<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    .atsyntax {color:#E80000;background-color:#E0E0E0}
    .atsyntax span.comment {color:#787878;font-style:italic}
    .atsyntax span.extern  {color:#A52A2A}
    .atsyntax span.keyword {color:#000000;font-weight:bold}
    .atsyntax span.neuexp  {color:#800080}
    .atsyntax span.staexp  {color:#0000FF}
    .atsyntax span.dynexp  {color:#E80000}
    .atsyntax span.prfexp  {color:#009000}
    .atsyntax span.stacstdec  {text-decoration:none}
    .atsyntax span.stacstuse  {color:#0000CF;text-decoration:underline}
    .atsyntax span.dyncstdec  {text-decoration:none}
    .atsyntax span.dyncstimp  {color:#B80000;text-decoration:underline}
    .atsyntax span.dyncstuse  {color:#B80000;text-decoration:underline}
    body {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre class="atsyntax">

<span class="comment">(*
** CAS CS525, Spring 2011
** Instructor: Hongwei Xi
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">"trans2.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"trans_cpp.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"error.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"absyn.sats"</span>
<span class="keyword">staload</span> <span class="staexp">"symbol.sats"</span>

<span class="comment">// staload _(*anon*) = "symbol.dats"
</span>
<span class="comment">// typedef opr = $Absyn.opr
</span>
<span class="comment">// typedef loc = $Posloc.location_t
</span><span class="comment">// typedef symbol = $Symbol.symbol_t
</span><span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anon*)</span> <span class="keyword">=</span> "prelude/DATS/list.dats"</span> 
<span class="keyword">staload</span> <span class="staexp">_<span class="comment">(*anon*)</span> <span class="keyword">=</span> "prelude/DATS/list0.dats"</span> 
<span class="comment">// staload _(*anon*) = "prelude/DATS/reference.dats" 
</span><span class="comment">// 
</span><span class="keyword">#define</span> <span class="neuexp">:: list0_cons</span>
<span class="keyword">#define</span> <span class="neuexp">cons list0_cons</span>
<span class="keyword">#define</span> <span class="neuexp">nil list0_nil</span>

<span class="keyword">val</span> env_str <span class="keyword">=</span> "env"
<span class="keyword">val</span> env_tmpvar <span class="keyword">=</span> tmpvar_new <span class="keyword">(</span>env_str<span class="keyword">)</span>
<span class="keyword">val</span> env_arg <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2535"><span class="dyncstuse">make_valprim</span></a> <span class="keyword">(</span>VPtmp <span class="keyword">(</span>env_tmpvar<span class="keyword">)</span><span class="keyword">,</span> T2YPenv<span class="keyword">)</span>

<span class="comment">(* header for the generated cpp files *)</span>
<span class="keyword">val</span> header <span class="keyword">=</span> "#include \"stfpl_header.h\"\n\n"<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span>
<span class="keyword">val</span> header <span class="keyword">=</span> <span class="keyword">(</span>header + "#include &lt;stdio.h&gt;\n\n"<span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span>
<span class="comment">// val ftyp_0 = "__ftype0": string  // nullary function type
</span><span class="comment">// val ftyp_1 = "__ftype1": string  // multi args function type
</span><span class="comment">// val header_ftyp = "typedef void * (*" + ftyp_0 + ")();\n"
</span><span class="comment">// val header_ftyp = header_ftyp + "typedef void * (*" + ftyp_1 + ")(void *);\n"
</span>
<span class="comment">(* string functions *)</span>
<span class="comment">// todo
</span><span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="1153"><span class="dyncstdec">string_implode <span class="keyword">(</span>cs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15295"><span class="stacstuse">char</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span></span></a> <span class="keyword">=</span> "atspre_string_implode"
<span class="keyword">extern</span>
<span class="keyword">fun</span> <a name="1230"><span class="dyncstdec">string_explode <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15295"><span class="stacstuse">char</span></a></span></span></a> <span class="keyword">=</span> "atspre_string_explode"

<span class="keyword">fun</span> string_formalize <span class="keyword">(</span>str<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> cs <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#1230"><span class="dyncstuse">string_explode</span></a> <span class="keyword">(</span>str<span class="keyword">)</span>
  <span class="keyword">fun</span> loop <span class="keyword">(</span>cs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15295"><span class="stacstuse">char</span></a></span><span class="keyword">,</span> accu<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15295"><span class="stacstuse">char</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15295"><span class="stacstuse">char</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> cs <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>c<span class="keyword">,</span> cs1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">if</span> c <span class="keyword">=</span> '\n' <span class="keyword">then</span> loop <span class="keyword">(</span>cs1<span class="keyword">,</span> 'n' :: '\\' :: accu<span class="keyword">)</span>
                       <span class="keyword">else</span> loop <span class="keyword">(</span>cs1<span class="keyword">,</span> c :: accu<span class="keyword">)</span>
    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> accu

  <span class="keyword">val</span> cs <span class="keyword">=</span> loop <span class="keyword">(</span>cs<span class="keyword">,</span> nil<span class="keyword">)</span>
  <span class="keyword">val</span> cs <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2flist0_2esats.html#5374"><span class="dyncstuse">list0_reverse</span></a> <span class="keyword">(</span>cs<span class="keyword">)</span>
  <span class="keyword">val</span> cs <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#1153"><span class="dyncstuse">string_implode</span></a> <span class="keyword">(</span>cs<span class="keyword">)</span>
  <span class="keyword">val</span> cs <span class="keyword">=</span> "\"" + cs + "\""
<span class="keyword">in</span>
  cs
<span class="keyword">end</span>




<span class="comment">// #define Some0 option0_some
</span><span class="comment">// #define None0 option0_none
</span>
<span class="keyword">local</span>
  <span class="keyword">assume</span> <span class="staexp">ostream_t <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span>
<span class="keyword">in</span>
  <span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#767"><span class="dyncstimp">ostream_new</span></a> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> ""

  <span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#796"><span class="dyncstimp">ostream_in</span></a> <span class="keyword">(</span>os<span class="keyword">,</span> s<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> os := <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2fstring_2esats.html#13066"><span class="dyncstuse">string0_append</span></a><span class="keyword">(</span>os<span class="keyword">,</span> s<span class="keyword">)</span>
  <span class="keyword">in</span> <span class="keyword">end</span>

  <span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#844"><span class="dyncstimp">print_ostream</span></a> <span class="keyword">(</span>os<span class="keyword">)</span> <span class="keyword">=</span> print os
<span class="keyword">end</span>  <span class="comment">// end of [local]
</span>
<span class="keyword">datatype</span> <span class="staexp"><a name="2024"><span class="stacstdec">statement_t</span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> STATplain <span class="keyword">of</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span>
  <span class="keyword">|</span> STATcomp <span class="keyword">of</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2097"><span class="stacstuse">statements_t</span></a></span>
<span class="keyword">where</span> <span class="staexp"><a name="2097"><span class="stacstdec">statements_t <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2024"><span class="stacstuse">statement_t</span></a></span></a></span>

<span class="keyword">typedef</span> <span class="staexp"><a name="2139"><span class="stacstdec">statements <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2097"><span class="stacstuse">statements_t</span></a></span></a></span>
<span class="keyword">typedef</span> <span class="staexp"><a name="2173"><span class="stacstdec">statement <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2024"><span class="stacstuse">statement_t</span></a></span></a></span>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="2209"><span class="dyncstdec">statements_to_string <span class="keyword">(</span>stats<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span><span class="keyword">,</span> level<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15585"><span class="stacstuse">int</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span></span></a>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="2282"><span class="dyncstdec">trans_cpp_instrs <span class="keyword">(</span>instrs<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3424"><span class="stacstuse">instrlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span></span></a>
<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="2341"><span class="dyncstdec">trans_cpp_fundef <span class="keyword">(</span>fundef<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#1260"><span class="stacstuse">funent</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span></span></a>

<span class="keyword">val</span> arg_pad <span class="keyword">=</span> "__args"<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span>
<span class="keyword">val</span> indent_pad <span class="keyword">=</span> "  "<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span>
<span class="keyword">val</span> scope_beg <span class="keyword">=</span> "{"<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span>
<span class="keyword">val</span> scope_end <span class="keyword">=</span> "}"<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2209"><span class="dyncstimp">statements_to_string</span></a> <span class="keyword">(</span>stats<span class="keyword">,</span> level<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> level_string <span class="keyword">(</span>i<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15585"><span class="stacstuse">int</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span> <span class="keyword">=</span>
    <span class="keyword">if</span> i &lt;= 0 <span class="keyword">then</span> "" <span class="keyword">else</span> indent_pad + level_string <span class="keyword">(</span>i - 1<span class="keyword">)</span>
  
  <span class="keyword">val</span> indent_pad <span class="keyword">=</span> level_string <span class="keyword">(</span>level<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> stats <span class="keyword">of</span>
  <span class="keyword">|</span> cons <span class="keyword">(</span>stat<span class="keyword">,</span> stats1<span class="keyword">)</span> <span class="keyword">=&gt;</span> 
    <span class="keyword">(</span><span class="keyword">case+</span> stat <span class="keyword">of</span>
    <span class="keyword">|</span> STATplain str <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> cur <span class="keyword">=</span> indent_pad + str + "\n"
      <span class="keyword">val</span> rest <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2209"><span class="dyncstuse">statements_to_string</span></a> <span class="keyword">(</span>stats1<span class="keyword">,</span> level<span class="keyword">)</span>
    <span class="keyword">in</span>
      cur + rest
    <span class="keyword">end</span>
    <span class="keyword">|</span> STATcomp stats' <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> cur <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2209"><span class="dyncstuse">statements_to_string</span></a> <span class="keyword">(</span>stats'<span class="keyword">,</span> level + 1<span class="keyword">)</span>
      <span class="keyword">val</span> rest <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2209"><span class="dyncstuse">statements_to_string</span></a> <span class="keyword">(</span>stats1<span class="keyword">,</span> level<span class="keyword">)</span>
    <span class="keyword">in</span>
      cur + rest
    <span class="keyword">end</span>
    <span class="keyword">)</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ""
<span class="keyword">end</span>  <span class="comment">// end of [statements_to_string]
</span>
<span class="keyword">fun</span> trans_cpp_typ <span class="keyword">(</span>t2yp<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#1483"><span class="stacstuse">t2yp</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span> <span class="keyword">=</span>
  <span class="keyword">case+</span> t2yp <span class="keyword">of</span>
  <span class="keyword">|</span> T2YPint <span class="keyword">(</span><span class="keyword">)</span>  <span class="keyword">=&gt;</span> "int"
  <span class="keyword">|</span> T2YPbool <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> "bool"
  <span class="keyword">|</span> T2YPstr <span class="keyword">(</span><span class="keyword">)</span>  <span class="keyword">=&gt;</span> "string"
  <span class="keyword">|</span> T2YPenv <span class="keyword">(</span><span class="keyword">)</span>  <span class="keyword">=&gt;</span> "env"
  <span class="keyword">|</span> T2YPlist <span class="keyword">(</span>_<span class="keyword">)</span> <span class="keyword">=&gt;</span> "list"
  <span class="keyword">|</span> T2YPvar <span class="keyword">(</span><span class="keyword">)</span>  <span class="keyword">=&gt;</span> "any"
  <span class="keyword">|</span> T2YPclo <span class="keyword">(</span>_<span class="keyword">,</span> _<span class="keyword">,</span> _<span class="keyword">)</span>  <span class="keyword">=&gt;</span> "closure"
  <span class="keyword">|</span> T2YPtup <span class="keyword">(</span>_<span class="keyword">)</span>  <span class="keyword">=&gt;</span> "tuple"

<span class="keyword">fun</span> trans_cpp_valprimlst_typ <span class="keyword">(</span>args<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2483"><span class="stacstuse">valprimlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span> <span class="keyword">=</span> loop <span class="keyword">(</span>args<span class="keyword">,</span> 0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">fun</span> loop <span class="keyword">(</span>args<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2483"><span class="stacstuse">valprimlst</span></a></span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15585"><span class="stacstuse">int</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span> <span class="keyword">=</span> 
    <span class="keyword">case+</span> args <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>arg<span class="keyword">,</span> args1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> t2yp <span class="keyword">=</span> arg<span class="keyword">.</span>valprim_typ

      <span class="keyword">val</span> arg_typ <span class="keyword">=</span> trans_cpp_typ <span class="keyword">(</span>t2yp<span class="keyword">)</span>
      <span class="keyword">val</span> arg_str <span class="keyword">=</span> <span class="keyword">if</span> <span class="keyword">(</span>i <span class="keyword">&gt;</span> 0<span class="keyword">)</span> <span class="keyword">then</span> ", " + arg_typ <span class="keyword">else</span> arg_typ
    <span class="keyword">in</span>
      arg_str + loop <span class="keyword">(</span>args1<span class="keyword">,</span> i + 1<span class="keyword">)</span>
    <span class="keyword">end</span>
    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ""
<span class="keyword">}</span>

<span class="keyword">fun</span> trans_cpp_args <span class="keyword">(</span>args<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2483"><span class="stacstuse">valprimlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span> <span class="keyword">=</span> loop <span class="keyword">(</span>args<span class="keyword">,</span> 0<span class="keyword">)</span> <span class="keyword">where</span> <span class="keyword">{</span>
  <span class="keyword">fun</span> loop <span class="keyword">(</span>args<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2483"><span class="stacstuse">valprimlst</span></a></span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15585"><span class="stacstuse">int</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span> <span class="keyword">=</span> 
    <span class="keyword">case+</span> args <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>arg<span class="keyword">,</span> args1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> t2yp <span class="keyword">=</span> arg<span class="keyword">.</span>valprim_typ
      <span class="keyword">val</span> node <span class="keyword">=</span> arg<span class="keyword">.</span>valprim_node
      <span class="keyword">val</span> tmpvar <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">case+</span> node <span class="keyword">of</span>
          <span class="keyword">|</span> VPtmp <span class="keyword">(</span>tmpvar<span class="keyword">)</span> <span class="keyword">=&gt;</span> tmpvar
          <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> <span class="keyword">let</span>
             <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#4210"><span class="dyncstuse">fprint_valprim</span></a> <span class="keyword">(</span>stderr_ref<span class="keyword">,</span> arg<span class="keyword">)</span>
          <span class="keyword">in</span>
             ETRACE_MSG_OPR <span class="keyword">(</span>"trans_cpp_args args should be VPtmp\n"<span class="keyword">,</span> 
                    ETRACE_LEVEL_ERROR<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ferror_2esats.html#120"><span class="dyncstuse">abort</span></a> <span class="keyword">(</span>ERRORCODE_FORBIDDEN<span class="keyword">)</span><span class="keyword">)</span>
          <span class="keyword">end</span>
          <span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#382"><span class="stacstuse">tmpvar</span></a></span>
      <span class="keyword">val</span> arg_nam <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>tmpvar<span class="keyword">)</span>
      <span class="keyword">val</span> arg_typ <span class="keyword">=</span> trans_cpp_typ <span class="keyword">(</span>t2yp<span class="keyword">)</span>
      <span class="keyword">val</span> arg_str <span class="keyword">=</span> arg_typ + " " + arg_nam
      <span class="keyword">val</span> arg_str <span class="keyword">=</span> <span class="keyword">if</span> <span class="keyword">(</span>i <span class="keyword">&gt;</span> 0<span class="keyword">)</span> <span class="keyword">then</span> ", " + arg_str <span class="keyword">else</span> arg_str
    <span class="keyword">in</span>
      arg_str + loop <span class="keyword">(</span>args1<span class="keyword">,</span> i + 1<span class="keyword">)</span>
    <span class="keyword">end</span>
    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> ""
<span class="keyword">}</span>

<span class="keyword">fun</span> trans_cpp_fun_decl <span class="keyword">(</span>ent<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#1243"><span class="stacstuse">funent_t</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> fl <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3770"><span class="dyncstuse">funent_get_lab</span></a> <span class="keyword">(</span>ent<span class="keyword">)</span>
  <span class="keyword">val</span> nam <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3983"><span class="dyncstuse">funlab_get_name</span></a> <span class="keyword">(</span>fl<span class="keyword">)</span>
  <span class="keyword">val</span> args <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3850"><span class="dyncstuse">funent_get_args</span></a> <span class="keyword">(</span>ent<span class="keyword">)</span>

  <span class="keyword">val</span> ret_vp <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3940"><span class="dyncstuse">funent_get_ret</span></a> <span class="keyword">(</span>ent<span class="keyword">)</span>
  <span class="keyword">val</span> ret_typ <span class="keyword">=</span> trans_cpp_typ <span class="keyword">(</span>ret_vp<span class="keyword">.</span>valprim_typ<span class="keyword">)</span>

  <span class="keyword">val</span> stat <span class="keyword">=</span> ret_typ + " " + nam + "("
  <span class="keyword">val</span> stat <span class="keyword">=</span> stat + trans_cpp_args <span class="keyword">(</span>cons <span class="keyword">(</span>env_arg<span class="keyword">,</span> args<span class="keyword">)</span><span class="keyword">)</span> + ")"
<span class="keyword">in</span>
  stat
<span class="keyword">end</span>

<span class="keyword">fun</span> trans_cpp_funlst_decl <span class="keyword">(</span>fns<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#1243"><span class="stacstuse">funent_t</span></a></span><span class="keyword">,</span> os<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#742"><span class="stacstuse"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#742"><span class="stacstuse">ostream</span></a></span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16468"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> helper <span class="keyword">(</span>init<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">,</span> ent<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#1243"><span class="stacstuse">funent_t</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> fn_str <span class="keyword">=</span> trans_cpp_fun_decl <span class="keyword">(</span>ent<span class="keyword">)</span>
    <span class="keyword">val</span> ret <span class="keyword">=</span> init + "\n" + fn_str + ";"
  <span class="keyword">in</span>
    ret
  <span class="keyword">end</span>

  <span class="keyword">val</span> header <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2flist0_2esats.html#3829"><span class="dyncstuse">list0_fold_left</span></a> <span class="keyword">(</span>helper<span class="keyword">,</span> ""<span class="keyword">,</span> fns<span class="keyword">)</span>
<span class="keyword">in</span>
  <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#796"><span class="dyncstuse">ostream_in</span></a> <span class="keyword">(</span>os<span class="keyword">,</span> header<span class="keyword">)</span>
<span class="keyword">end</span>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="5366"><span class="dyncstdec">trans_cpp_fun_body <span class="keyword">(</span>
  narg<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15585"><span class="stacstuse">int</span></a></span><span class="keyword">,</span> body<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3424"><span class="stacstuse">instrlst</span></a></span><span class="keyword">,</span> ret<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2360"><span class="stacstuse">valprim</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span></span></a>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="5454"><span class="dyncstdec">trans_cpp_instrlst <span class="keyword">(</span>body<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3424"><span class="stacstuse">instrlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span></span></a>
<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="5513"><span class="dyncstdec">trans_cpp_instr <span class="keyword">(</span>instr<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3331"><span class="stacstuse">instr</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span></span></a>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="5568"><span class="dyncstdec">trans_cpp_valprim <span class="keyword">(</span>vp<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2360"><span class="stacstuse">valprim</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span></span></a>
<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="5619"><span class="dyncstdec">trans_cpp_valprimlst <span class="keyword">(</span>vps<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2483"><span class="stacstuse">valprimlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span></span></a>

<span class="keyword">fun</span> trans_cpp_funlst_def <span class="keyword">(</span>fns<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#1243"><span class="stacstuse">funent_t</span></a></span><span class="keyword">,</span> os<span class="keyword">:</span> <span class="staexp"><span class="keyword">&amp;</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#742"><span class="stacstuse"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#742"><span class="stacstuse">ostream</span></a></span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16468"><span class="stacstuse">void</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> trans <span class="keyword">(</span>init<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">,</span> ent<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#1243"><span class="stacstuse">funent_t</span></a></span><span class="keyword">)</span><span class="keyword">:&lt;</span><span class="staexp">cloref1</span><span class="keyword">&gt;</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span> <span class="keyword">=</span> <span class="keyword">let</span>
    <span class="keyword">val</span> fl <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3770"><span class="dyncstuse">funent_get_lab</span></a> <span class="keyword">(</span>ent<span class="keyword">)</span>
    <span class="keyword">val</span> nargs <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3811"><span class="dyncstuse">funent_get_narg</span></a> <span class="keyword">(</span>ent<span class="keyword">)</span>
    <span class="keyword">val</span> body <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3896"><span class="dyncstuse">funent_get_body</span></a> <span class="keyword">(</span>ent<span class="keyword">)</span>
    <span class="keyword">val</span> ret <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3940"><span class="dyncstuse">funent_get_ret</span></a> <span class="keyword">(</span>ent<span class="keyword">)</span>
    <span class="keyword">val</span> nam <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3983"><span class="dyncstuse">funlab_get_name</span></a> <span class="keyword">(</span>fl<span class="keyword">)</span>

    <span class="keyword">val</span> fundef <span class="keyword">=</span> trans_cpp_fun_decl <span class="keyword">(</span>ent<span class="keyword">)</span>

    <span class="keyword">val</span> fundef <span class="keyword">=</span> fundef + "\n" + scope_beg + "\n"
    <span class="keyword">val</span> funbody <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5366"><span class="dyncstuse">trans_cpp_fun_body</span></a> <span class="keyword">(</span>nargs<span class="keyword">,</span> body<span class="keyword">,</span> ret<span class="keyword">)</span>
    <span class="keyword">val</span> fundef <span class="keyword">=</span> fundef + <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2209"><span class="dyncstuse">statements_to_string</span></a> <span class="keyword">(</span>funbody<span class="keyword">,</span> 1<span class="keyword">)</span>
    <span class="keyword">val</span> fundef <span class="keyword">=</span> fundef + scope_end + "\n\n"
  <span class="keyword">in</span>
    init + fundef
  <span class="keyword">end</span>

  <span class="keyword">val</span> header <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2flist0_2esats.html#3829"><span class="dyncstuse">list0_fold_left</span></a> <span class="keyword">(</span>trans<span class="keyword">,</span> ""<span class="keyword">,</span> fns<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#796"><span class="dyncstuse">ostream_in</span></a> <span class="keyword">(</span>os<span class="keyword">,</span> header<span class="keyword">)</span>
<span class="keyword">in</span>
<span class="keyword">end</span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5366"><span class="dyncstimp">trans_cpp_fun_body</span></a> <span class="keyword">(</span>narg<span class="keyword">,</span> body<span class="keyword">,</span> ret<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> stats <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5454"><span class="dyncstuse">trans_cpp_instrlst</span></a> <span class="keyword">(</span>body<span class="keyword">)</span>

  <span class="keyword">val</span> ret_typ <span class="keyword">=</span> ret<span class="keyword">.</span>valprim_typ
  <span class="keyword">val</span> ret_typ <span class="keyword">=</span> trans_cpp_typ <span class="keyword">(</span>ret_typ<span class="keyword">)</span>

  <span class="keyword">val</span> stats <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2flist0_2esats.html#2814"><span class="dyncstuse">list0_append&lt;</span></a><span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2173"><span class="stacstuse">statement</span></a></span><span class="keyword">&gt;</span> <span class="keyword">(</span>stats<span class="keyword">,</span> 
              cons <span class="keyword">(</span>STATplain <span class="keyword">(</span>"return (" + ret_typ + ")" + 
                <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5568"><span class="dyncstuse">trans_cpp_valprim</span></a> <span class="keyword">(</span>ret<span class="keyword">)</span> + ";"<span class="keyword">)</span><span class="keyword">,</span> nil<span class="keyword">)</span><span class="keyword">)</span>
<span class="keyword">in</span>
  stats
<span class="keyword">end</span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5568"><span class="dyncstimp">trans_cpp_valprim</span></a> <span class="keyword">(</span>vp<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> node <span class="keyword">=</span> vp<span class="keyword">.</span>valprim_node
  <span class="keyword">val</span> typ <span class="keyword">=</span> vp<span class="keyword">.</span>valprim_typ
  <span class="keyword">val</span> typ_str <span class="keyword">=</span> trans_cpp_typ <span class="keyword">(</span>typ<span class="keyword">)</span>
<span class="keyword">in</span>
  <span class="keyword">case+</span> node <span class="keyword">of</span>
  <span class="keyword">|</span> VPenv <span class="keyword">(</span>pos<span class="keyword">)</span> <span class="keyword">=&gt;</span> "(" + typ_str + ")env_get(" + 
        <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>env_tmpvar<span class="keyword">)</span> + ", " + <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2finteger_2esats.html#5650"><span class="dyncstuse">tostring_int</span></a> <span class="keyword">(</span>pos<span class="keyword">)</span> + ")"
  <span class="keyword">|</span> VPbool <span class="keyword">(</span>b<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2fbool_2esats.html#3780"><span class="dyncstuse">tostring_bool</span></a> <span class="keyword">(</span>b<span class="keyword">)</span>
  <span class="keyword">|</span> VPclo <span class="keyword">(</span>tmpvar<span class="keyword">,</span> fl<span class="keyword">,</span> vps<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>tmpvar<span class="keyword">)</span>
  <span class="keyword">|</span> VPint <span class="keyword">(</span>i<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2finteger_2esats.html#5650"><span class="dyncstuse">tostring_int</span></a> <span class="keyword">(</span>i<span class="keyword">)</span>
  <span class="keyword">|</span> VPstr <span class="keyword">(</span>str<span class="keyword">)</span> <span class="keyword">=&gt;</span> string_formalize <span class="keyword">(</span>str<span class="keyword">)</span>
  <span class="keyword">|</span> VPtmp <span class="keyword">(</span>tmpvar<span class="keyword">)</span> <span class="keyword">=&gt;</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>tmpvar<span class="keyword">)</span>
  <span class="keyword">|</span> VPtup <span class="keyword">(</span>tmpvar<span class="keyword">,</span> vps<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="comment">// val () = printf ("trans_cpp_valprim -- VPtup\n", @())
</span>    <span class="keyword">val</span> ret <span class="keyword">=</span> <span class="keyword">if</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2flist0_2esats.html#4694"><span class="dyncstuse">list0_length</span></a> <span class="keyword">(</span>vps<span class="keyword">)</span> <span class="keyword">=</span> 0 <span class="keyword">then</span> 
          "0" <span class="keyword">else</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>tmpvar<span class="keyword">)</span>
    <span class="comment">// val () = printf ("trans_cpp_valprim10 -- VPtup\n", @())
</span>  <span class="keyword">in</span>
    ret
  <span class="keyword">end</span>
<span class="keyword">end</span>


<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5619"><span class="dyncstimp">trans_cpp_valprimlst</span></a> <span class="keyword">(</span>vps<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> vps <span class="keyword">of</span> 
  <span class="keyword">|</span> cons <span class="keyword">(</span>vp<span class="keyword">,</span> vps1<span class="keyword">)</span> <span class="keyword">=&gt;</span> cons <span class="keyword">(</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5568"><span class="dyncstuse">trans_cpp_valprim</span></a> <span class="keyword">(</span>vp<span class="keyword">)</span><span class="keyword">,</span> 
                             <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5619"><span class="dyncstuse">trans_cpp_valprimlst</span></a> <span class="keyword">(</span>vps1<span class="keyword">)</span><span class="keyword">)</span>
  <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5454"><span class="dyncstimp">trans_cpp_instrlst</span></a> <span class="keyword">(</span>body<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">fun</span> loop <span class="keyword">(</span>body<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3424"><span class="stacstuse">instrlst</span></a></span><span class="keyword">,</span> accu<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> body <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>instr<span class="keyword">,</span> body1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="comment">// val () = printf ("trans_cpp_instrlst\n", @())
</span>      <span class="keyword">val</span> stats <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5513"><span class="dyncstuse">trans_cpp_instr</span></a> <span class="keyword">(</span>instr<span class="keyword">)</span>
      <span class="comment">// val () = printf ("trans_cpp_instrlst10\n", @())
</span>      <span class="keyword">val</span> accu <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2flist0_2esats.html#2814"><span class="dyncstuse">list0_append</span></a> <span class="keyword">(</span>accu<span class="keyword">,</span> stats<span class="keyword">)</span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>body1<span class="keyword">,</span> accu<span class="keyword">)</span>
    <span class="keyword">end</span>
    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> accu
<span class="keyword">in</span>
  loop <span class="keyword">(</span>body<span class="keyword">,</span> nil<span class="keyword">)</span>
<span class="keyword">end</span>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="8103"><span class="dyncstdec">trans_cpp_instr_call <span class="keyword">(</span>ret<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#382"><span class="stacstuse">tmpvar</span></a></span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2360"><span class="stacstuse">valprim</span></a></span><span class="keyword">,</span> 
  args<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2483"><span class="stacstuse">valprimlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span></span></a>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="8195"><span class="dyncstdec">trans_cpp_instr_cond <span class="keyword">(</span>ret<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#382"><span class="stacstuse">tmpvar</span></a></span><span class="keyword">,</span> typ<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#1483"><span class="stacstuse">t2yp</span></a></span><span class="keyword">,</span> vp<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2360"><span class="stacstuse">valprim</span></a></span><span class="keyword">,</span> 
  brthen<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3424"><span class="stacstuse">instrlst</span></a></span><span class="keyword">,</span> brelse<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3424"><span class="stacstuse">instrlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span></span></a>
  
<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="8319"><span class="dyncstdec">trans_cpp_instr_opr <span class="keyword">(</span>ret<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#382"><span class="stacstuse">tmpvar</span></a></span><span class="keyword">,</span> typ<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#1483"><span class="stacstuse">t2yp</span></a></span><span class="keyword">,</span> opr<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fabsyn_2esats.html#1029"><span class="stacstuse">opr</span></a></span><span class="keyword">,</span> 
  args<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2483"><span class="stacstuse">valprimlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span></span></a>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="8419"><span class="dyncstdec">trans_cpp_instr_tup <span class="keyword">(</span>ret<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#382"><span class="stacstuse">tmpvar</span></a></span><span class="keyword">,</span> vps<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2483"><span class="stacstuse">valprimlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span></span></a>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="8494"><span class="dyncstdec">trans_cpp_instr_closure <span class="keyword">(</span>
  ret<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#382"><span class="stacstuse">tmpvar</span></a></span><span class="keyword">,</span> fl<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#933"><span class="stacstuse">funlab_t</span></a></span><span class="keyword">,</span> vps<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2483"><span class="stacstuse">valprimlst</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span></span></a>

<span class="keyword">extern</span> <span class="keyword">fun</span> <a name="8590"><span class="dyncstdec">trans_cpp_instr_proj <span class="keyword">(</span>ret<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#382"><span class="stacstuse">tmpvar</span></a></span><span class="keyword">,</span> typ<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#1483"><span class="stacstuse">t2yp</span></a></span><span class="keyword">,</span> vp<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2360"><span class="stacstuse">valprim</span></a></span><span class="keyword">,</span> 
  pos<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15585"><span class="stacstuse">int</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span></span></a>


<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8319"><span class="dyncstimp">trans_cpp_instr_opr</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> typ<span class="keyword">,</span> opr<span class="keyword">,</span> args<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val+</span> OPR sym <span class="keyword">=</span> opr
  <span class="keyword">val</span> vs <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5619"><span class="dyncstuse">trans_cpp_valprimlst</span></a> <span class="keyword">(</span>args<span class="keyword">)</span>
  <span class="keyword">val</span> typ_str <span class="keyword">=</span> trans_cpp_typ <span class="keyword">(</span>typ<span class="keyword">)</span>
  <span class="keyword">val</span> stat <span class="keyword">=</span> typ_str + " " + <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>ret<span class="keyword">)</span> + " = "
  <span class="keyword">val</span> <span class="keyword">(</span>opr_str<span class="keyword">,</span> needret<span class="keyword">)</span> <span class="keyword">=</span> 
    <span class="keyword">(</span><span class="keyword">case+</span> 0 <span class="keyword">of</span>
    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1183"><span class="dyncstuse">symbol_PLUS</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> s1 :: s2 :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>s1 + " + " + s2<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4352"><span class="dyncstuse">true</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1217"><span class="dyncstuse">symbol_MINUS</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> s1 :: s2 :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>s1 + " - " + s2<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4352"><span class="dyncstuse">true</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1252"><span class="dyncstuse">symbol_TIMES</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> s1 :: s2 :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>s1 + " * " + s2<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4352"><span class="dyncstuse">true</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1287"><span class="dyncstuse">symbol_SLASH</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> s1 :: s2 :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>s1 + " / " + s2<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4352"><span class="dyncstuse">true</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1146"><span class="dyncstuse">symbol_UMINUS</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> s1 :: _ <span class="keyword">=</span> vs <span class="keyword">in</span> <span class="keyword">(</span>"-1 * " + s1<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4352"><span class="dyncstuse">true</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1323"><span class="dyncstuse">symbol_GT</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> s1 :: s2 :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>s1 + " &gt; " + s2<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4352"><span class="dyncstuse">true</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1355"><span class="dyncstuse">symbol_GTE</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> s1 :: s2 :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>s1 + " &gt;= " + s2<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4352"><span class="dyncstuse">true</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1389"><span class="dyncstuse">symbol_LT</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> s1 :: s2 :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>s1 + " &lt; " + s2<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4352"><span class="dyncstuse">true</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1421"><span class="dyncstuse">symbol_LTE</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> s1 :: s2 :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>s1 + " &lt;= " + s2<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4352"><span class="dyncstuse">true</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1455"><span class="dyncstuse">symbol_EQ</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>      
        <span class="keyword">val-</span> s1 :: s2 :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>s1 + " == " + s2<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4352"><span class="dyncstuse">true</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1487"><span class="dyncstuse">symbol_NEQ</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> s1 :: s2 :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>s1 + " != " + s2<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4352"><span class="dyncstuse">true</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1522"><span class="dyncstuse">symbol_PRINT</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> s :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>"printf(\"%s\", " + s + ")"<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4408"><span class="dyncstuse">false</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">when</span> sym <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2fsymbol_2esats.html#1561"><span class="dyncstuse">symbol_PRINT_INT</span></a> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
        <span class="keyword">val-</span> i  :: _ <span class="keyword">=</span> vs
      <span class="keyword">in</span>
        <span class="keyword">(</span>"printf(\"%d\", " + i + ")"<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fdyn_2esats.html#4408"><span class="dyncstuse">false</span></a><span class="keyword">)</span>
      <span class="keyword">end</span> <span class="comment">// end of [_ when ...]
</span>    <span class="keyword">|</span> _ <span class="keyword">=&gt;</span> ETRACE_MSG_OPR <span class="keyword">(</span>"trans_cpp_instr_opr unsupported operator\n"<span class="keyword">,</span> 
                      ETRACE_LEVEL_ERROR<span class="keyword">,</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ferror_2esats.html#120"><span class="dyncstuse">abort</span></a> <span class="keyword">(</span>ERRORCODE_FORBIDDEN<span class="keyword">)</span><span class="keyword">)</span>
      <span class="comment">// end of [_]
</span>    <span class="keyword">)</span>

    <span class="keyword">val</span> stat <span class="keyword">=</span> <span class="keyword">(</span><span class="keyword">if</span> needret <span class="keyword">then</span> stat + opr_str + ";" 
                <span class="keyword">else</span> stat + "0;" + opr_str + ";"<span class="keyword">)</span>
<span class="keyword">in</span>
  cons <span class="keyword">(</span>STATplain <span class="keyword">(</span>stat<span class="keyword">)</span><span class="keyword">,</span> nil<span class="keyword">)</span>
<span class="keyword">end</span>  <span class="comment">// end of [trans_cpp_instr_opr]
</span>
<span class="comment">(*
extern fun trans_cpp_instr_tup (ret: tmpvar, vps: valprimlst): statements
*)</span>
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8419"><span class="dyncstimp">trans_cpp_instr_tup</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> vps<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> len <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2flist0_2esats.html#4694"><span class="dyncstuse">list0_length</span></a> <span class="keyword">(</span>vps<span class="keyword">)</span>
  <span class="comment">// val len_str = tostring_int (len)
</span>  <span class="keyword">val</span> nam <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>ret<span class="keyword">)</span>
  <span class="keyword">val</span> stat <span class="keyword">=</span> STATplain <span class="keyword">(</span><span class="keyword">if</span> len <span class="keyword">=</span> 0 <span class="keyword">then</span> "tuple " + nam + " = 0;"
              <span class="keyword">else</span> "tuple " + nam + " = tuple_create();"<span class="keyword">)</span>

  <span class="keyword">val</span> elements <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5619"><span class="dyncstuse">trans_cpp_valprimlst</span></a> <span class="keyword">(</span>vps<span class="keyword">)</span>

  <span class="keyword">fun</span> fill_tup <span class="keyword">(</span>nam<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">,</span> elements<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">,</span> pos<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15585"><span class="stacstuse">int</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> elements <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>ele<span class="keyword">,</span> elements1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> stat <span class="keyword">=</span> STATplain <span class="keyword">(</span>"tuple_add(" + nam + ", (void*)" + ele + ");"<span class="keyword">)</span>
    <span class="keyword">in</span>
      cons <span class="keyword">(</span>stat<span class="keyword">,</span> fill_tup <span class="keyword">(</span>nam<span class="keyword">,</span> elements1<span class="keyword">,</span> pos + 1<span class="keyword">)</span><span class="keyword">)</span>
    <span class="keyword">end</span>
    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> nil

  <span class="keyword">val</span> stats_fill <span class="keyword">=</span> fill_tup <span class="keyword">(</span>nam<span class="keyword">,</span> elements<span class="keyword">,</span> 0<span class="keyword">)</span>
<span class="keyword">in</span>
  cons <span class="keyword">(</span>stat<span class="keyword">,</span> stats_fill<span class="keyword">)</span>
<span class="keyword">end</span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8195"><span class="dyncstimp">trans_cpp_instr_cond</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> typ<span class="keyword">,</span> vp<span class="keyword">,</span> brthen<span class="keyword">,</span> brelse<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="comment">// val () = printf ("trans_cpp_instr_cond\n", @())
</span>  <span class="keyword">val</span> ret_str <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>ret<span class="keyword">)</span>
  <span class="keyword">val</span> ret_typ <span class="keyword">=</span> trans_cpp_typ <span class="keyword">(</span>typ<span class="keyword">)</span>
  <span class="keyword">val</span> stat_dec <span class="keyword">=</span> STATplain <span class="keyword">(</span>ret_typ + " " + ret_str + ";"<span class="keyword">)</span>

  <span class="keyword">val</span> v_str <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5568"><span class="dyncstuse">trans_cpp_valprim</span></a> <span class="keyword">(</span>vp<span class="keyword">)</span>
  <span class="keyword">val</span> stat_if <span class="keyword">=</span> STATplain <span class="keyword">(</span>"if (" + v_str + ")"<span class="keyword">)</span>
  
  <span class="comment">// val () = printf ("trans_cpp_instr_cond10\n", @())
</span>  <span class="keyword">val</span> stats_then <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5454"><span class="dyncstuse">trans_cpp_instrlst</span></a> <span class="keyword">(</span>brthen<span class="keyword">)</span>
  <span class="comment">// val () = printf ("trans_cpp_instr_cond20\n", @())
</span>  <span class="keyword">val</span> stats_else <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5454"><span class="dyncstuse">trans_cpp_instrlst</span></a> <span class="keyword">(</span>brelse<span class="keyword">)</span>
  <span class="comment">// val () = printf ("trans_cpp_instr_cond30\n", @())
</span><span class="keyword">in</span>
  stat_dec :: stat_if :: STATplain <span class="keyword">(</span>scope_beg<span class="keyword">)</span> 
    :: STATcomp <span class="keyword">(</span>stats_then<span class="keyword">)</span> :: STATplain <span class="keyword">(</span>scope_end<span class="keyword">)</span> 
    :: STATplain <span class="keyword">(</span>"else"<span class="keyword">)</span> :: STATplain <span class="keyword">(</span>scope_beg<span class="keyword">)</span> :: STATcomp <span class="keyword">(</span>stats_else<span class="keyword">)</span> 
    :: STATplain <span class="keyword">(</span>scope_end<span class="keyword">)</span> :: nil
<span class="keyword">end</span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8590"><span class="dyncstimp">trans_cpp_instr_proj</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> typ<span class="keyword">,</span> vp<span class="keyword">,</span> pos<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> ret_str <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>ret<span class="keyword">)</span>
  <span class="keyword">val</span> ret_typ <span class="keyword">=</span> trans_cpp_typ <span class="keyword">(</span>typ<span class="keyword">)</span>
  <span class="keyword">val</span> v_str <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5568"><span class="dyncstuse">trans_cpp_valprim</span></a> <span class="keyword">(</span>vp<span class="keyword">)</span>

  <span class="keyword">val</span> stats <span class="keyword">=</span> STATplain <span class="keyword">(</span>ret_typ + ret_str + " = " + 
              "tuple_get(" + v_str + ", " + <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2finteger_2esats.html#5650"><span class="dyncstuse">tostring_int</span></a> <span class="keyword">(</span>pos<span class="keyword">)</span> + ");"<span class="keyword">)</span>
<span class="keyword">in</span>
  stats :: nil
<span class="keyword">end</span>

<span class="comment">(* extern fun trans_cpp_instr_closure (
  ret: tmpvar, fl: funlab_t, vps: valprimlst): statements *)</span>
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8494"><span class="dyncstimp">trans_cpp_instr_closure</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> fl<span class="keyword">,</span> vps<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> ret_str <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>ret<span class="keyword">)</span>
  <span class="keyword">val</span> stat_c_clo <span class="keyword">=</span> "closure " + ret_str + " = closure_create();"

  <span class="keyword">val</span> f_nam <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3983"><span class="dyncstuse">funlab_get_name</span></a> <span class="keyword">(</span>fl<span class="keyword">)</span>
  <span class="keyword">val</span> stat_add_fun <span class="keyword">=</span> "closure_put_fun(" + ret_str + ", (void*)" + f_nam + ");"

  <span class="keyword">fun</span> loop <span class="keyword">(</span>clo_nam<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">,</span> vps<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2483"><span class="stacstuse">valprimlst</span></a></span><span class="keyword">,</span>
    init<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2139"><span class="stacstuse">statements</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> vps <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>vp<span class="keyword">,</span> vps1<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
      <span class="keyword">val</span> arg <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5568"><span class="dyncstuse">trans_cpp_valprim</span></a> <span class="keyword">(</span>vp<span class="keyword">)</span>
      <span class="keyword">val</span> stat <span class="keyword">=</span> "closure_add_env(" + clo_nam + ", (void*)" + arg + ");"
      <span class="keyword">val</span> init' <span class="keyword">=</span> cons <span class="keyword">(</span>STATplain stat<span class="keyword">,</span> init<span class="keyword">)</span>
    <span class="keyword">in</span>
      loop <span class="keyword">(</span>clo_nam<span class="keyword">,</span> vps1<span class="keyword">,</span> init'<span class="keyword">)</span>
    <span class="keyword">end</span>
    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> init

  <span class="keyword">val</span> stats <span class="keyword">=</span> cons <span class="keyword">(</span>STATplain stat_c_clo<span class="keyword">,</span> nil<span class="keyword">)</span>
  <span class="keyword">val</span> stats <span class="keyword">=</span> cons <span class="keyword">(</span>STATplain stat_add_fun<span class="keyword">,</span> stats<span class="keyword">)</span>
  <span class="keyword">val</span> stats <span class="keyword">=</span> loop <span class="keyword">(</span>ret_str<span class="keyword">,</span> vps<span class="keyword">,</span> stats<span class="keyword">)</span>
  <span class="keyword">val</span> stats <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2flist0_2esats.html#5374"><span class="dyncstuse">list0_reverse</span></a> <span class="keyword">(</span>stats<span class="keyword">)</span>
<span class="keyword">in</span>
  stats
<span class="keyword">end</span>

<span class="comment">(*
extern fun trans_cpp_instr_call (ret: tmpvar, f: valprim, 
  args: valprimlst): statements
*)</span>
<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8103"><span class="dyncstimp">trans_cpp_instr_call</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> f<span class="keyword">,</span> args<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">val</span> ret_str <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>ret<span class="keyword">)</span>

  <span class="comment">// name of the closure
</span>  <span class="keyword">val</span> f_nam <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5568"><span class="dyncstuse">trans_cpp_valprim</span></a> <span class="keyword">(</span>f<span class="keyword">)</span>

  <span class="comment">// build the function type
</span>  <span class="keyword">val</span> f_typ <span class="keyword">=</span> f<span class="keyword">.</span>valprim_typ
  <span class="keyword">val-</span> T2YPclo <span class="keyword">(</span>nargs<span class="keyword">,</span> args_typ<span class="keyword">,</span> ret_typ<span class="keyword">)</span> <span class="keyword">=</span> f_typ
  <span class="keyword">val</span> args_typ_str <span class="keyword">=</span> trans_cpp_valprimlst_typ <span class="keyword">(</span>args<span class="keyword">)</span>
  <span class="keyword">val</span> ret_typ_str <span class="keyword">=</span> trans_cpp_typ <span class="keyword">(</span>ret_typ<span class="keyword">)</span>
  <span class="keyword">val</span> clo_typ_str <span class="keyword">=</span> "(" + ret_typ_str + " (*)(env, " + args_typ_str + "))"

  <span class="keyword">val</span> args_strlst <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5619"><span class="dyncstuse">trans_cpp_valprimlst</span></a> <span class="keyword">(</span>args<span class="keyword">)</span>

  <span class="keyword">fun</span> loop <span class="keyword">(</span>init<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">,</span> args<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#22196"><span class="stacstuse">list0</span></a> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#15585"><span class="stacstuse">int</span></a></span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fbasics_5fsta_2esats.html#16164"><span class="stacstuse">string</span></a></span> <span class="keyword">=</span>
    <span class="keyword">case+</span> args <span class="keyword">of</span>
    <span class="keyword">|</span> cons <span class="keyword">(</span>arg<span class="keyword">,</span> args1<span class="keyword">)</span> <span class="keyword">=&gt;</span> loop <span class="keyword">(</span>init + <span class="keyword">(</span><span class="keyword">if</span> i <span class="keyword">&gt;</span> 0 <span class="keyword">then</span> ", " <span class="keyword">else</span> ""<span class="keyword">)</span> + arg<span class="keyword">,</span> args1<span class="keyword">,</span> i + 1<span class="keyword">)</span>
    <span class="keyword">|</span> nil <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=&gt;</span> init

  <span class="keyword">val</span> args_str <span class="keyword">=</span> "(closure_get_env(" + f_nam + ")" + ", " + loop <span class="keyword">(</span>""<span class="keyword">,</span> args_strlst<span class="keyword">,</span> 0<span class="keyword">)</span> + ")"

  <span class="keyword">val</span> stats <span class="keyword">=</span> STATplain <span class="keyword">(</span>ret_typ_str + " " + ret_str + " = " + 
             "(*" + clo_typ_str + "closure_get_fun(" + f_nam + "))" + args_str + ";"<span class="keyword">)</span> :: nil
<span class="keyword">in</span>
  stats
<span class="keyword">end</span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5513"><span class="dyncstimp">trans_cpp_instr</span></a> <span class="keyword">(</span>instr<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">case+</span> instr<span class="keyword">.</span>instr_node <span class="keyword">of</span>
  <span class="keyword">|</span> INSTRcall <span class="keyword">(</span>ret<span class="keyword">,</span> f<span class="keyword">,</span> args<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8103"><span class="dyncstuse">trans_cpp_instr_call</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> f<span class="keyword">,</span> args<span class="keyword">)</span>
  <span class="keyword">|</span> INSTRcond <span class="keyword">(</span>ret<span class="keyword">,</span> typ<span class="keyword">,</span> v<span class="keyword">,</span> brthen<span class="keyword">,</span> brelse<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8195"><span class="dyncstuse">trans_cpp_instr_cond</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> typ<span class="keyword">,</span> v<span class="keyword">,</span> brthen<span class="keyword">,</span> brelse<span class="keyword">)</span>
  <span class="keyword">|</span> INSTRmove_val <span class="keyword">(</span>tmpv<span class="keyword">,</span> vp<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="comment">// val () = printf ("trans_cpp_instr -- INSTRmove_val\n", @())
</span>    <span class="keyword">val</span> nam <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#405"><span class="dyncstuse">tmpvar_get_name</span></a> <span class="keyword">(</span>tmpv<span class="keyword">)</span>
    <span class="comment">// val () = printf ("trans_cpp_instr -- INSTRmove_val10\n", @())
</span>    <span class="keyword">val</span> vpnam <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#5568"><span class="dyncstuse">trans_cpp_valprim</span></a> <span class="keyword">(</span>vp<span class="keyword">)</span>
    <span class="comment">// val () = printf ("trans_cpp_instr -- INSTRmove_val20\n", @())
</span>    <span class="keyword">val</span> stat <span class="keyword">=</span> STATplain <span class="keyword">(</span>nam + " = " + vpnam + ";"<span class="keyword">)</span>
    <span class="comment">// val () = printf ("trans_cpp_instr -- INSTRmove_val30\n", @())
</span>  <span class="keyword">in</span>
    cons <span class="keyword">(</span>stat<span class="keyword">,</span> nil<span class="keyword">)</span>
  <span class="keyword">end</span>
  <span class="keyword">|</span> INSTRopr <span class="keyword">(</span>ret<span class="keyword">,</span> t2yp<span class="keyword">,</span> opr<span class="keyword">,</span> vps<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="comment">// val () = printf ("opr\n", @())
</span>  <span class="keyword">in</span>
    <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8319"><span class="dyncstuse">trans_cpp_instr_opr</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> t2yp<span class="keyword">,</span> opr<span class="keyword">,</span> vps<span class="keyword">)</span>
  <span class="keyword">end</span>
  <span class="keyword">|</span> INSTRtup <span class="keyword">(</span>ret<span class="keyword">,</span> vps<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8419"><span class="dyncstuse">trans_cpp_instr_tup</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> vps<span class="keyword">)</span>
  <span class="keyword">|</span> INSTRclosure <span class="keyword">(</span>ret<span class="keyword">,</span> fl<span class="keyword">,</span> vps<span class="keyword">)</span> <span class="keyword">=&gt;</span>
    <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8494"><span class="dyncstuse">trans_cpp_instr_closure</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> fl<span class="keyword">,</span> vps<span class="keyword">)</span>
  <span class="keyword">|</span> INSTRproj <span class="keyword">(</span>ret<span class="keyword">,</span> typ<span class="keyword">,</span> v<span class="keyword">,</span> pos<span class="keyword">)</span> <span class="keyword">=&gt;</span> <span class="keyword">let</span>
    <span class="comment">// val () = printf ("proj\n", @())
</span>  <span class="keyword">in</span>
    <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#8590"><span class="dyncstuse">trans_cpp_instr_proj</span></a> <span class="keyword">(</span>ret<span class="keyword">,</span> typ<span class="keyword">,</span> v<span class="keyword">,</span> pos<span class="keyword">)</span>
  <span class="keyword">end</span>

<span class="keyword">implement</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#883"><span class="dyncstimp">trans_cpp</span></a> <span class="keyword">(</span>instrs<span class="keyword">,</span> fns<span class="keyword">)</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> os <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#767"><span class="dyncstuse">ostream_new</span></a> <span class="keyword">(</span><span class="keyword">)</span>

  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#796"><span class="dyncstuse">ostream_in</span></a> <span class="keyword">(</span>os<span class="keyword">,</span> header<span class="keyword">)</span>
  <span class="comment">// val () = ostream_in (os, header_ftyp)
</span>
  <span class="keyword">val</span> main_ent <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#4046"><span class="dyncstuse">funent_make</span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#4025"><span class="dyncstuse">mainlab</span></a><span class="keyword">,</span> 1<span class="keyword">,</span> nil<span class="keyword">,</span> instrs<span class="keyword">,</span> 
    <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#2535"><span class="dyncstuse">make_valprim</span></a> <span class="keyword">(</span>VPint 0<span class="keyword">,</span> T2YPint<span class="keyword">)</span> <span class="comment">(*just a dummy return value*)</span><span class="keyword">,</span> nil<span class="keyword">)</span>
  <span class="keyword">val</span> fns <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fats_5fpack_2fats_2dlang_2danairiats_2d0_2e2_2e4_2fprelude_2fSATS_2flist0_2esats.html#2814"><span class="dyncstuse">list0_append</span></a> <span class="keyword">(</span>fns<span class="keyword">,</span> cons <span class="keyword">(</span>main_ent<span class="keyword">,</span> nil<span class="keyword">)</span><span class="keyword">)</span>

  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans_cpp_funlst_decl <span class="keyword">(</span>fns<span class="keyword">,</span> os<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#796"><span class="dyncstuse">ostream_in</span></a> <span class="keyword">(</span>os<span class="keyword">,</span> "\n\n"<span class="keyword">)</span>
  <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> trans_cpp_funlst_def <span class="keyword">(</span>fns<span class="keyword">,</span> os<span class="keyword">)</span>
 
   <span class="keyword">val</span> body_stats <span class="keyword">=</span> STATplain <span class="keyword">(</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#3983"><span class="dyncstuse">funlab_get_name</span></a> <span class="keyword">(</span><a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans2_2esats.html#4025"><span class="dyncstuse">mainlab</span></a><span class="keyword">)</span> + "(0);"<span class="keyword">)</span>
       :: STATplain <span class="keyword">(</span>"return 0;"<span class="keyword">)</span> :: nil
  
   <span class="keyword">val</span> main_stats <span class="keyword">=</span> STATplain <span class="keyword">(</span>"int main (int argc, char *argv)"<span class="keyword">)</span>
       :: STATplain <span class="keyword">(</span>scope_beg<span class="keyword">)</span> :: STATcomp <span class="keyword">(</span>body_stats<span class="keyword">)</span>
       :: STATplain <span class="keyword">(</span>scope_end<span class="keyword">)</span> :: nil
   
   <span class="keyword">val</span> mainstr <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2edats.html#2209"><span class="dyncstuse">statements_to_string</span></a> <span class="keyword">(</span>main_stats<span class="keyword">,</span> 0<span class="keyword">)</span>
 
   <span class="keyword">val</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> <a href="XREF/_2fhome_2fatsuser_2fcourses_2fcs525_5fCompiler_2fassignment02_2ftrans_5fcpp_2esats.html#796"><span class="dyncstuse">ostream_in</span></a> <span class="keyword">(</span>os<span class="keyword">,</span> mainstr<span class="keyword">)</span>
<span class="keyword">in</span>
  os
<span class="keyword">end</span>





</pre>
</body>
</html>
