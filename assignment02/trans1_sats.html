<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <style type="text/css">
    .atsyntax {color:#E80000;background-color:#E0E0E0}
    .atsyntax span.comment {color:#787878;font-style:italic}
    .atsyntax span.extern  {color:#A52A2A}
    .atsyntax span.keyword {color:#000000;font-weight:bold}
    .atsyntax span.neuexp  {color:#800080}
    .atsyntax span.staexp  {color:#0000FF}
    .atsyntax span.dynexp  {color:#E80000}
    .atsyntax span.prfexp  {color:#009000}
    .atsyntax span.stacstdec  {text-decoration:none}
    .atsyntax span.stacstuse  {color:#0000CF;text-decoration:underline}
    .atsyntax span.dyncstdec  {text-decoration:none}
    .atsyntax span.dyncstimp  {color:#B80000;text-decoration:underline}
    .atsyntax span.dyncstuse  {color:#B80000;text-decoration:underline}
    body {color:#E80000;background-color:#E0E0E0}
  </style>
</head>
<body>
<pre class="atsyntax">
<span class="comment">(*
** CAS CS525, Spring 2011
** Instructor: Hongwei Xi
*)</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Symbol <span class="keyword">=</span> "symbol.sats"</span>
<span class="keyword">staload</span> <span class="staexp">Posloc <span class="keyword">=</span> "contrib/parcomb/SATS/posloc.sats"</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">staload</span> <span class="staexp">Absyn <span class="keyword">=</span> "absyn.sats"</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">datatype</span> <span class="staexp"><a name="244"><span class="stacstdec">t1yp</span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> T1YPbase <span class="keyword">of</span> <span class="staexp">$Symbol<span class="keyword">.</span>symbol_t</span>
  <span class="keyword">|</span> T1YPfun <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>t1yp<span class="keyword">,</span> t1yp<span class="keyword">)</span></span>
  <span class="keyword">|</span> T1YPtup <span class="keyword">of</span> <span class="staexp">t1yplst</span>
<span class="comment">// end of [t1yp]
</span>
<span class="keyword">where</span> <span class="staexp"><a name="359"><span class="stacstdec">t1yplst <span class="keyword">=</span> list0 <span class="keyword">(</span>t1yp<span class="keyword">)</span></span></a></span>
  <span class="keyword">and</span> <span class="staexp"><a name="388"><span class="stacstdec">t1ypopt <span class="keyword">=</span> option0 <span class="keyword">(</span>t1yp<span class="keyword">)</span></span></a></span>

<span class="keyword">fun</span> <a name="418"><span class="dyncstdec">fprint_t1yp <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span></a> 
<span class="keyword">fun</span> <a name="465"><span class="dyncstdec">fprint_t1yplst <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> t<span class="keyword">:</span> <span class="staexp">t1yplst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span></a> 

<span class="keyword">fun</span> <a name="519"><span class="dyncstdec">print_t1yp <span class="keyword">(</span>t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span></a> 
<span class="keyword">fun</span> <a name="551"><span class="dyncstdec">prerr_t1yp <span class="keyword">(</span>t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span></a> 

<span class="neuexp"><span class="keyword">overload</span> print <span class="keyword">with</span> print_t1yp</span>
<span class="neuexp"><span class="keyword">overload</span> prerr <span class="keyword">with</span> prerr_t1yp</span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">datatype</span> <span class="staexp"><a name="673"><span class="stacstdec">e1xp_node</span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> E1XPann <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>e1xp<span class="keyword">,</span> t1yp<span class="keyword">)</span></span>
  <span class="keyword">|</span> E1XPapp <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>e1xp<span class="keyword">,</span> e1xp<span class="keyword">)</span></span>
  <span class="keyword">|</span> E1XPbool <span class="keyword">of</span> <span class="staexp">bool</span>
  <span class="keyword">|</span> E1XPfix <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>v1ar<span class="keyword">,</span> v1arlst<span class="keyword">,</span> e1xp<span class="keyword">)</span></span>
  <span class="keyword">|</span> E1XPif <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>e1xp<span class="keyword">,</span> e1xp<span class="keyword">,</span> e1xpopt<span class="keyword">)</span></span>
  <span class="keyword">|</span> E1XPint <span class="keyword">of</span> <span class="staexp">int</span>
  <span class="keyword">|</span> E1XPlam <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>v1arlst<span class="keyword">,</span> e1xp<span class="keyword">)</span></span>
  <span class="keyword">|</span> E1XPlet <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>d1eclst<span class="keyword">,</span> e1xp<span class="keyword">)</span></span>
  <span class="keyword">|</span> E1XPopr <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>$Absyn<span class="keyword">.</span>opr<span class="keyword">,</span> e1xplst<span class="keyword">)</span></span>
  <span class="keyword">|</span> E1XPproj <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>e1xp<span class="keyword">,</span> int<span class="keyword">)</span></span>
  <span class="keyword">|</span> E1XPstr <span class="keyword">of</span> <span class="staexp">string</span>
  <span class="keyword">|</span> E1XPtup <span class="keyword">of</span> <span class="staexp">e1xplst</span>
  <span class="keyword">|</span> E1XPvar <span class="keyword">of</span> <span class="staexp">v1ar</span>

<span class="keyword">and</span> <span class="staexp"><a name="1051"><span class="stacstdec">d1ec_node</span></a></span> <span class="keyword">=</span>
  <span class="keyword">|</span> D1ECval <span class="keyword">of</span> <span class="staexp"><span class="keyword">(</span>bool<span class="comment">(*isrec*)</span><span class="keyword">,</span> v1aldeclst<span class="keyword">)</span></span>
<span class="comment">// end of [d1ec_node]
</span>
<span class="keyword">where</span> <span class="staexp"><a name="1135"><span class="stacstdec">e1xp <span class="keyword">=</span> <span class="keyword">'{</span>
  e1xp_loc<span class="keyword">=</span> $Posloc<span class="keyword">.</span>location_t
<span class="keyword">,</span> e1xp_node<span class="keyword">=</span> e1xp_node
<span class="keyword">,</span> e1xp_typ<span class="keyword">=</span> t1yp
<span class="keyword">}</span></span></a></span> <span class="comment">// end of [e1xp]
</span>
<span class="keyword">and</span> <span class="staexp"><a name="1240"><span class="stacstdec">e1xplst <span class="keyword">=</span> list0 <span class="keyword">(</span>e1xp<span class="keyword">)</span></span></a></span>
<span class="keyword">and</span> <span class="staexp"><a name="1267"><span class="stacstdec">e1xpopt <span class="keyword">=</span> option0 <span class="keyword">(</span>e1xp<span class="keyword">)</span></span></a></span>

<span class="comment">// two purpose: 1. as functoin args; 2. as let declarations
</span><span class="keyword">and</span> <span class="staexp"><a name="1357"><span class="stacstdec">v1ar <span class="keyword">=</span> <span class="keyword">'{</span>  
  v1ar_loc<span class="keyword">=</span> $Posloc<span class="keyword">.</span>location_t<span class="keyword">,</span> v1ar_nam<span class="keyword">=</span> $Symbol<span class="keyword">.</span>symbol_t<span class="keyword">,</span> v1ar_typ<span class="keyword">=</span> t1yp<span class="keyword">,</span> v1ar_def<span class="keyword">=</span> e1xpopt
<span class="keyword">}</span></span></a></span> <span class="comment">// end of [v1ar]
</span><span class="keyword">and</span> <span class="staexp"><a name="1486"><span class="stacstdec">v1arlst <span class="keyword">=</span> list0 <span class="keyword">(</span>v1ar<span class="keyword">)</span></span></a></span>

<span class="keyword">and</span> <span class="staexp"><a name="1514"><span class="stacstdec">d1ec <span class="keyword">=</span> <span class="keyword">'{</span>
  d1ec_loc<span class="keyword">=</span> $Posloc<span class="keyword">.</span>location_t<span class="keyword">,</span> d1ec_node<span class="keyword">=</span> d1ec_node
<span class="keyword">}</span></span></a></span>
<span class="keyword">and</span> <span class="staexp"><a name="1583"><span class="stacstdec">d1eclst <span class="keyword">=</span> list0 <span class="keyword">(</span>d1ec<span class="keyword">)</span></span></a></span>

<span class="keyword">and</span> <span class="staexp"><a name="1611"><span class="stacstdec">v1aldec <span class="keyword">=</span> <span class="keyword">'{</span>
  v1aldec_loc<span class="keyword">=</span> $Posloc<span class="keyword">.</span>location_t
<span class="keyword">,</span> v1aldec_var<span class="keyword">=</span> v1ar
<span class="keyword">,</span> v1aldec_def<span class="keyword">=</span> e1xp
<span class="keyword">}</span></span></a></span>
<span class="keyword">and</span> <span class="staexp"><a name="1704"><span class="stacstdec">v1aldeclst <span class="keyword">=</span> list0 <span class="keyword">(</span>v1aldec<span class="keyword">)</span></span></a></span>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> <a name="1759"><span class="dyncstdec">fprint_e1xp <span class="keyword">(</span>out<span class="keyword">:</span> <span class="staexp">FILEref</span><span class="keyword">,</span> e<span class="keyword">:</span> <span class="staexp">e1xp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span></a>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> <a name="1827"><span class="dyncstdec">v1ar_make <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> _<span class="keyword">:</span> <span class="staexp">$Symbol<span class="keyword">.</span>symbol_t</span><span class="keyword">,</span> _<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">v1ar</span></span></a>

<span class="keyword">fun</span> <a name="1902"><span class="dyncstdec">eq_v1ar_v1ar
  <span class="keyword">(</span>x1<span class="keyword">:</span> <span class="staexp">v1ar</span><span class="keyword">,</span> x2<span class="keyword">:</span> <span class="staexp">v1ar</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">bool</span></span></a> <span class="keyword">=</span> "eq_v1ar_v1ar"
<span class="neuexp"><span class="keyword">overload</span> <span class="keyword">=</span> <span class="keyword">with</span> eq_v1ar_v1ar</span>

<span class="keyword">fun</span> <a name="1995"><span class="dyncstdec">v1ar_set_def
  <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">v1ar</span><span class="keyword">,</span> def<span class="keyword">:</span> <span class="staexp">e1xpopt</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span></a> <span class="keyword">=</span> "v1ar_set_def"
<span class="comment">// end of [v1ar_set_def]
</span>
<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> <a name="2108"><span class="dyncstdec">e1xp_make_ann <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> e<span class="keyword">:</span> <span class="staexp">e1xp</span><span class="keyword">,</span> t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="2174"><span class="dyncstdec">e1xp_make_app <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> e1<span class="keyword">:</span> <span class="staexp">e1xp</span><span class="keyword">,</span> e2<span class="keyword">:</span> <span class="staexp">e1xp</span><span class="keyword">,</span> t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="2251"><span class="dyncstdec">e1xp_make_bool <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> b<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="2309"><span class="dyncstdec">e1xp_make_fix <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> f<span class="keyword">:</span> <span class="staexp">v1ar</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">v1arlst</span><span class="keyword">,</span> body<span class="keyword">:</span> <span class="staexp">e1xp</span><span class="keyword">,</span> t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="2400"><span class="dyncstdec">e1xp_make_if <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> e1<span class="keyword">:</span> <span class="staexp">e1xp</span><span class="keyword">,</span> e2<span class="keyword">:</span> <span class="staexp">e1xp</span><span class="keyword">,</span> oe3<span class="keyword">:</span> <span class="staexp">e1xpopt</span><span class="keyword">,</span> t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="2490"><span class="dyncstdec">e1xp_make_int <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="2546"><span class="dyncstdec">e1xp_make_lam <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> xs<span class="keyword">:</span> <span class="staexp">v1arlst</span><span class="keyword">,</span> body<span class="keyword">:</span> <span class="staexp">e1xp</span><span class="keyword">,</span> t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="2628"><span class="dyncstdec">e1xp_make_let <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> decs<span class="keyword">:</span> <span class="staexp">d1eclst</span><span class="keyword">,</span> body<span class="keyword">:</span> <span class="staexp">e1xp</span><span class="keyword">,</span> t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="2712"><span class="dyncstdec">e1xp_make_opr <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> opr<span class="keyword">:</span> <span class="staexp">$Absyn<span class="keyword">.</span>opr</span><span class="keyword">,</span> es<span class="keyword">:</span> <span class="staexp">e1xplst</span><span class="keyword">,</span> t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="2799"><span class="dyncstdec">e1xp_make_proj <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> e<span class="keyword">:</span> <span class="staexp">e1xp</span><span class="keyword">,</span> i<span class="keyword">:</span> <span class="staexp">int</span><span class="keyword">,</span> t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="2874"><span class="dyncstdec">e1xp_make_str <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> s<span class="keyword">:</span> <span class="staexp">string</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="2933"><span class="dyncstdec">e1xp_make_tup <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> es<span class="keyword">:</span> <span class="staexp">e1xplst</span><span class="keyword">,</span> t<span class="keyword">:</span> <span class="staexp">t1yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>
<span class="keyword">fun</span> <a name="3003"><span class="dyncstdec">e1xp_make_var <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">v1ar</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>

<span class="keyword">fun</span> <a name="3061"><span class="dyncstdec">v1aldec_make <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> x<span class="keyword">:</span> <span class="staexp">v1ar</span><span class="keyword">,</span> def<span class="keyword">:</span> <span class="staexp">e1xp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">v1aldec</span></span></a>
<span class="keyword">fun</span> <a name="3131"><span class="dyncstdec">d1ec_make_val <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Posloc<span class="keyword">.</span>location_t</span><span class="keyword">,</span> isrec<span class="keyword">:</span> <span class="staexp">bool</span><span class="keyword">,</span> vds<span class="keyword">:</span> <span class="staexp">v1aldeclst</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">d1ec</span></span></a>

<span class="comment">(* ****** ****** *)</span>

<span class="keyword">fun</span> <a name="3231"><span class="dyncstdec">trans1_typ <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Absyn<span class="keyword">.</span>t0yp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">t1yp</span></span></a>
<span class="keyword">fun</span> <a name="3269"><span class="dyncstdec">trans1_exp <span class="keyword">(</span>_<span class="keyword">:</span> <span class="staexp">$Absyn<span class="keyword">.</span>e0xp</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">e1xp</span></span></a>

<span class="comment">(* ****** ****** *)</span>

<span class="comment">(* end of [trans1.sats] *)</span>
</pre>
</body>
</html>
